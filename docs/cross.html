<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Single parameter models | Bayesian Data Analysis</title>
  <meta name="description" content="Chapter 2 Single parameter models | Bayesian Data Analysis review by Andrew Gelman, supervised by Dr. Paul Marjoram" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Single parameter models | Bayesian Data Analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Chapter 2 Single parameter models | Bayesian Data Analysis review by Andrew Gelman, supervised by Dr. Paul Marjoram" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Single parameter models | Bayesian Data Analysis" />
  
  <meta name="twitter:description" content="Chapter 2 Single parameter models | Bayesian Data Analysis review by Andrew Gelman, supervised by Dr. Paul Marjoram" />
  

<meta name="author" content="Anthony R. Colombo, Dr. Paul Marjoram" />


<meta name="date" content="2022-07-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="fundamentals-of-bayesian-inference.html"/>
<link rel="next" href="chapter-3.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Bayesian Data Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#independent-study"><i class="fa fa-check"></i>Independent study</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#supervised-learning"><i class="fa fa-check"></i>Supervised learning</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html"><i class="fa fa-check"></i><b>1</b> Fundamentals of Bayesian Inference</a>
<ul>
<li class="chapter" data-level="1.1" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html#general-notation-for-statistical-inference"><i class="fa fa-check"></i><b>1.1</b> General notation for statistical inference</a>
<ul>
<li class="chapter" data-level="" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html#exchangeability"><i class="fa fa-check"></i>Exchangeability</a></li>
<li class="chapter" data-level="" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html#explanatory-variables"><i class="fa fa-check"></i>Explanatory variables</a></li>
<li class="chapter" data-level="" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html#hierarchical-modeling"><i class="fa fa-check"></i>Hierarchical modeling</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html#bayesian-inference"><i class="fa fa-check"></i><b>1.2</b> Bayesian inference</a></li>
<li class="chapter" data-level="" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html#prediction"><i class="fa fa-check"></i>Prediction</a></li>
<li class="chapter" data-level="" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html#likelihood"><i class="fa fa-check"></i>Likelihood</a></li>
<li class="chapter" data-level="" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html#subjectivity-and-objectivity"><i class="fa fa-check"></i>Subjectivity and Objectivity</a></li>
<li class="chapter" data-level="1.3" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a></li>
<li class="chapter" data-level="" data-path="fundamentals-of-bayesian-inference.html"><a href="fundamentals-of-bayesian-inference.html#simulation-100-times"><i class="fa fa-check"></i>Simulation 100 times</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cross.html"><a href="cross.html"><i class="fa fa-check"></i><b>2</b> Single parameter models</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cross.html"><a href="cross.html#estimating-a-probability-from-binomial-data"><i class="fa fa-check"></i><b>2.1</b> Estimating a probability from binomial data</a></li>
<li class="chapter" data-level="2.2" data-path="cross.html"><a href="cross.html#posterior-as-a-compromise-between-data-and-prior-information"><i class="fa fa-check"></i><b>2.2</b> Posterior as a compromise between data and prior information</a></li>
<li class="chapter" data-level="2.3" data-path="cross.html"><a href="cross.html#summarizing-the-posterior-inference"><i class="fa fa-check"></i><b>2.3</b> Summarizing the posterior inference</a>
<ul>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#posterior-quantiles-and-intervals"><i class="fa fa-check"></i>Posterior quantiles and intervals</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="cross.html"><a href="cross.html#informative-prior-distributions"><i class="fa fa-check"></i><b>2.4</b> Informative prior distributions</a>
<ul>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#conjugate-prior-distributions"><i class="fa fa-check"></i>Conjugate prior distributions</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#conjugate-prior-distributions-exponential-families-and-sufficient-statistics"><i class="fa fa-check"></i>Conjugate prior, distributions, exponential families, and sufficient statistics</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="cross.html"><a href="cross.html#normal-distribution-with-known-variance"><i class="fa fa-check"></i><b>2.5</b> Normal distribution with known variance</a>
<ul>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#likelihood-of-one-data-point"><i class="fa fa-check"></i>Likelihood of one data point</a></li>
<li class="chapter" data-level="2.5.1" data-path="cross.html"><a href="cross.html#conjugate-prior-and-posterior-distributions"><i class="fa fa-check"></i><b>2.5.1</b> Conjugate prior and posterior distributions</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#posterior-predictive-distribution"><i class="fa fa-check"></i>Posterior predictive distribution</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#normal-model-with-multiple-observations"><i class="fa fa-check"></i>Normal model with multiple observations</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="cross.html"><a href="cross.html#other-standard-single-parameter-models"><i class="fa fa-check"></i><b>2.6</b> Other standard single-parameter models</a>
<ul>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#normal-distribution-with-known-mean-but-unknown-variance"><i class="fa fa-check"></i>Normal distribution with known mean but unknown variance</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#poisson-model"><i class="fa fa-check"></i>Poisson model</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#negative-binomial-distribution"><i class="fa fa-check"></i>Negative Binomial distribution</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="cross.html"><a href="cross.html#exercises-1"><i class="fa fa-check"></i><b>2.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#question-1"><i class="fa fa-check"></i>Question 1</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#normal-approximation-example"><i class="fa fa-check"></i>Normal approximation example</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#question-3"><i class="fa fa-check"></i>Question 3</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#question-4"><i class="fa fa-check"></i>Question 4</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#question-7"><i class="fa fa-check"></i>Question 7</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#question-8-normal-distribution-with-unknown-mean"><i class="fa fa-check"></i>Question 8 (Normal distribution with unknown mean)</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#question-10"><i class="fa fa-check"></i>Question 10</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#question-11"><i class="fa fa-check"></i>Question 11</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#question-12"><i class="fa fa-check"></i>Question 12</a></li>
<li class="chapter" data-level="" data-path="cross.html"><a href="cross.html#question-13"><i class="fa fa-check"></i>Question 13</a></li>
<li class="chapter" data-level="2.7.1" data-path="cross.html"><a href="cross.html#question-21"><i class="fa fa-check"></i><b>2.7.1</b> Question 21</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-3.html"><a href="chapter-3.html"><i class="fa fa-check"></i><b>3</b> Chapter 3</a></li>
<li class="chapter" data-level="" data-path="exercises-2.html"><a href="exercises-2.html"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exercises-2.html"><a href="exercises-2.html#question-1-1"><i class="fa fa-check"></i><b>3.1</b> Question 1</a></li>
<li class="chapter" data-level="" data-path="exercises-2.html"><a href="exercises-2.html#question-2"><i class="fa fa-check"></i>Question 2</a></li>
<li class="chapter" data-level="" data-path="exercises-2.html"><a href="exercises-2.html#question-3-1"><i class="fa fa-check"></i>Question 3</a></li>
<li class="chapter" data-level="" data-path="exercises-2.html"><a href="exercises-2.html#question-4-1"><i class="fa fa-check"></i>Question 4</a></li>
<li class="chapter" data-level="" data-path="exercises-2.html"><a href="exercises-2.html#question-5"><i class="fa fa-check"></i>Question 5</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html"><i class="fa fa-check"></i><b>4</b> Footnotes and citations</a>
<ul>
<li class="chapter" data-level="4.1" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#footnotes"><i class="fa fa-check"></i><b>4.1</b> Footnotes</a></li>
<li class="chapter" data-level="4.2" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#citations"><i class="fa fa-check"></i><b>4.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>5</b> Blocks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>5.1</b> Equations</a></li>
<li class="chapter" data-level="5.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>5.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="5.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>5.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>6</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>6.1</b> Publishing</a></li>
<li class="chapter" data-level="6.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>6.2</b> 404 pages</a></li>
<li class="chapter" data-level="6.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>6.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="7" data-path="parts.html"><a href="parts.html"><i class="fa fa-check"></i><b>7</b> Parts</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Data Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cross" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Single parameter models<a href="cross.html#cross" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="estimating-a-probability-from-binomial-data" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Estimating a probability from binomial data<a href="cross.html#estimating-a-probability-from-binomial-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="math display" id="eq:binomialProb">\[\begin{equation}
p(y  | \theta) = {n \choose y}\theta^y(1-\theta)^{n-y}
\tag{2.1}
\end{equation}\]</span></p>
<p>To perform Bayesian inference we assume <span class="math inline">\(\theta \sim U(0,1)\)</span> where the posterior is</p>
<p><span class="math display" id="eq:binomialPosterior">\[\begin{equation}
p(\theta | y) \propto \theta^y(1-\theta)^{n-y}
\tag{2.2}
\end{equation}\]</span></p>
<p>which is the form of a <code>beta</code> distribution <span class="math inline">\(\theta | y \sim Beta(y+1, n-y+1)\)</span></p>
</div>
<div id="posterior-as-a-compromise-between-data-and-prior-information" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Posterior as a compromise between data and prior information<a href="cross.html#posterior-as-a-compromise-between-data-and-prior-information" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The posterior is less variable than the prior because it incorporates the information from the data.</p>
<p><span class="math display" id="eq:adamsLaw">\[\begin{equation}
E(\theta) = E(E(\theta | y))
\tag{2.3}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:evesLaw">\[\begin{equation}
V(\theta) = E(V(\theta|y)) + V(E(\theta | y))
\tag{2.4}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\theta|y\)</span> is the posterior. So the average of the prior, is the average of the posterior means over the distribution of possible data. The variance of the prior <a href="cross.html#eq:evesLaw">(2.4)</a> says the posterior variance is on average smaller than the prior variance.</p>
</div>
<div id="summarizing-the-posterior-inference" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Summarizing the posterior inference<a href="cross.html#summarizing-the-posterior-inference" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The mean, median, mode, and standard deviation of the posterior distribution summarize the all the current information about a model.</p>
<div id="posterior-quantiles-and-intervals" class="section level3 unnumbered hasAnchor">
<h3>Posterior quantiles and intervals<a href="cross.html#posterior-quantiles-and-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The posterior uncertainty can be reported by presenting the quantiles of the posterior distribution. The interval, a <em>central interval of posterior probability</em> corresponds to the case of 100(<span class="math inline">\(1-\alpha)\%\)</span>, to the range of values above and below which lies exactly 100(<span class="math inline">\(\alpha/2)\%\)</span> of the posterior probability. The interval estimates are <em>posterior intervals</em>. This differences from the confidence interval because the confidence interval is not a probability interval, because either the parameter is within the region or it is not, but the confidence interval provides information in the long run over repeated experimentation as to how many experiments would contain the true parameter.</p>
<p>There is also the <em>highest posterior interval</em> which is a probabilistic interval that is not less than any region outside of the interval.</p>
</div>
</div>
<div id="informative-prior-distributions" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Informative prior distributions<a href="cross.html#informative-prior-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>the property that the posterior distribution follows the same parametric form as the prior distribution is called <em>conjugacy</em>. Where the beta prior distribution is a <em>conjugate family</em> for the binomial likelihood.</p>
<p>so given the binomial likelihood <span class="math inline">\(p(y|\theta)\propto \theta^a(1-\theta)^b\)</span>, and a prior density <span class="math inline">\(p(\theta)\propto \theta^{\alpha-1}(1-\theta)^{\beta-1}\)</span> the posterior is of the beta family.</p>
<p><span class="math display">\[
\begin{aligned}
p(\theta | y) &amp;\propto \theta^y(1-\theta)^{n-y}\theta^{\alpha-1}(1-\theta)^{\beta-1}\\
&amp;= \theta^{y+\alpha-1}(1-\theta)^{n-y+\beta-1}\\
&amp;= Beta(\theta | \alpha+y, \beta+n-y)
\end{aligned}
\]</span></p>
<div id="conjugate-prior-distributions" class="section level3 unnumbered hasAnchor">
<h3>Conjugate prior distributions<a href="cross.html#conjugate-prior-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Conjugacy is formally defined as if F is a class of sampling distributions <span class="math inline">\(p(y|\theta)\)</span>, and P is a class of prior distributions for <span class="math inline">\(\theta\)</span>, then the class P is conjugate for F if <span class="math inline">\(p(\theta | y) \in P\)</span> for all <span class="math inline">\(p(.|\theta)\in F\)</span> and <span class="math inline">\(p(.)\in P\)</span>.</p>
</div>
<div id="conjugate-prior-distributions-exponential-families-and-sufficient-statistics" class="section level3 unnumbered hasAnchor">
<h3>Conjugate prior, distributions, exponential families, and sufficient statistics<a href="cross.html#conjugate-prior-distributions-exponential-families-and-sufficient-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Posterior distributions can be derived using sufficient statistics from exponential families. The exponential family is defined as</p>
<p><span class="math display">\[
\begin{aligned}
p(y_i | \theta)=f(y_i)g(\theta)e^{\phi(\theta)^Tu(y_i)}
\end{aligned}
\]</span>
Where <span class="math inline">\(\phi(\theta), u(y_i)\)</span> are vectors of equal dimension to that of <span class="math inline">\(\theta\)</span>. The <span class="math inline">\(\phi(\theta)\)</span> is called the <em>natural parameter</em> for the family (F). The likelihood of a sequence <span class="math inline">\(y=(y_1,...,y_n)\)</span> iid is</p>
<p><span class="math display">\[
\begin{aligned}
p(y | \theta)&amp;= (\prod_{i=1}^n f(y_i)) g(\theta)^n exp(\phi(\theta)^T \sum_{i=1}^n u(y_i)) \\
  &amp;\propto g(\theta)^ne^{\phi(\theta)^Tt(y)}, t(y)=\sum_{y=1}^n u(y_i)
\end{aligned}
\]</span></p>
<p>The <em>sufficient statistic</em> for <span class="math inline">\(\theta\)</span> is <span class="math inline">\(t(y)\)</span> because the likelihood for $depends on the data, y, only through the value of t(y).</p>
<p>Sufficient statistics benefit posterior distributions because if the prior density is specified as
<span class="math display">\[
\begin{aligned}
p(\theta)&amp;\propto g(\theta)^{\eta} e^{\phi(\theta)^T \nu} \\
\end{aligned}
\]</span>
Then the posterior density using sufficient statistics is</p>
<p><span class="math display">\[
\begin{aligned}
p(\theta | y ) &amp;\propto g(\theta)^{\eta+n} e^{\phi(\theta)^T (\nu+t(y))} \\
\end{aligned}
\]</span></p>
<p>Exponential families are the only classes of distributions that have natural conjugate prior distributions.</p>
</div>
</div>
<div id="normal-distribution-with-known-variance" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Normal distribution with known variance<a href="cross.html#normal-distribution-with-known-variance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The normal distribution is foundational to statistical modeling, with the central limit theorem (CLT) allowing for the use of normal likelihood in many statistical problems which can approximate complex likelihoods. If the normal distribution does not provide a good model fit, finite mixtures of distributions can identify useful solutions.</p>
<div id="likelihood-of-one-data-point" class="section level3 unnumbered hasAnchor">
<h3>Likelihood of one data point<a href="cross.html#likelihood-of-one-data-point" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>With mean <span class="math inline">\(\theta\)</span> and known variance <span class="math inline">\(\sigma^2\)</span> the sampling distribution of a given point is defined</p>
<p><span class="math inline">\(p(y|\theta) = \frac{1}{\sqrt{2*\pi*\sigma^2}}e^{-\frac{1}{2\sigma^2} (y-\theta)^2}\)</span></p>
</div>
<div id="conjugate-prior-and-posterior-distributions" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Conjugate prior and posterior distributions<a href="cross.html#conjugate-prior-and-posterior-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The prior has the exponential family form given as <span class="math inline">\(\theta \sim N(\mu_0, \tau_0^2)\)</span></p>
<p><span class="math display">\[
\begin{aligned}
p(\theta ) &amp;\propto exp( \frac{1}{2\tau_0^2}(\theta-\mu_0)^2) \\
\end{aligned}
\]</span></p>
<p>WHere completing the square can find the posterior distribution</p>
<p><span class="math display">\[
\begin{aligned}
p(\theta | y ) &amp;\propto exp(-1/2(\frac{(y-\theta)^2}{\sigma^2} +\frac{(\theta-\mu_0)^2}{\tau_0^2} )  ) \\
p(\theta | y ) &amp;\propto exp( \frac{1}{2\tau_1^2}(\theta-\mu_1)^2),  \theta|y \sim N(\mu_1,\tau_1^2)
\end{aligned}
\]</span>
where <span class="math inline">\(\mu_1 = \frac{1/\tau_0^2 \mu_0 + 1/\sigma^2 y}{1/\tau_0^2 + 1/\sigma^2}\)</span> and <span class="math inline">\(1/\tau_1^2 = 1/\tau_0^2 +1/\sigma^2\)</span></p>
<p>In manipulating the distributions the inverse of the variance is defined as the <em>precision</em>. The posterior precision is equal to the prior precision plus the data precision. And the posterior mean is a weighted average of the prior mean and the observed value, y, proportional to the total precision.</p>
</div>
<div id="posterior-predictive-distribution" class="section level3 unnumbered hasAnchor">
<h3>Posterior predictive distribution<a href="cross.html#posterior-predictive-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>the posterior predictive distribution of a future observation, x, p(x|y) can be calculated</p>
<p><span class="math display">\[
\begin{aligned}
p(x|y) &amp;= \int p(x|\theta)p(\theta|y) d\theta
&amp;\propto \int exp(-1/2\sigma^2 (x-\theta)^2) exp(-1/2\tau_1^2 (\theta-\mu_1)^2) d\theta
\end{aligned}
\]</span>
the future observations, x, does not depend on the past observations y given <span class="math inline">\(\theta\)</span>.</p>
</div>
<div id="normal-model-with-multiple-observations" class="section level3 unnumbered hasAnchor">
<h3>Normal model with multiple observations<a href="cross.html#normal-model-with-multiple-observations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For multiple observations, y, the posterior density is formulated as:</p>
<p><span class="math display">\[
\begin{aligned}
p(\theta | y ) &amp;\propto p(\theta)p(y|\theta) \\
   &amp;=p(\theta)\prod_i p(y_i | \theta)\\
   &amp;\propto exp(-1/2\tau_0^2 (\theta-\mu_0)^2)\prod_i exp(-1/2\sigma^2 (y_i -\theta)^2)\\
   &amp;\propto exp(-1/2 (1/\tau_0^2(\theta-\mu_0)^2+ 1/\sigma^2\sum_i(y_i-\theta)^2) )\\
\end{aligned}
\]</span>
Simplfying the algebra shows the posterior depends on y only through the sample mean (sufficient statistic), <span class="math inline">\(\bar{y}\)</span> is the sufficient statistic for <span class="math inline">\(\theta\)</span>, and the final model is <span class="math inline">\(\bar{y} | \theta,\sigma^2 \sim N(\theta, \sigma^2/n)\)</span></p>
</div>
</div>
<div id="other-standard-single-parameter-models" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Other standard single-parameter models<a href="cross.html#other-standard-single-parameter-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The binomial model is motivated by counting exchangeable outcomes. The normal distribution applies to a random variable that is the sum of many exchangeable- or independent terms. The poisson and exponential distribution applies to number of counts, rates, or waiting times for events modeled as occurring exchangeably in all time intervals, i.e. independently in time, and with a constant rate of occurrence.</p>
<div id="normal-distribution-with-known-mean-but-unknown-variance" class="section level3 unnumbered hasAnchor">
<h3>Normal distribution with known mean but unknown variance<a href="cross.html#normal-distribution-with-known-mean-but-unknown-variance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For <span class="math inline">\(p(y|\theta,\sigma^2)=N(y|\theta,\sigma^2)\)</span> with known mean and unknown variance the likelihood vector with iid observations follows</p>
<p><span class="math display">\[
\begin{aligned}
p( y | \sigma^2 ) &amp;\propto \sigma^{-n}exp(-1/2\sigma^2 \sum (y_i - \theta)^2) \\
   &amp;= (\sigma^2)^{-n/2}exp(-n/2\sigma^2 \nu)
   \end{aligned}
\]</span>
The sufficient statistic <span class="math inline">\(\nu = -1/n \sum (y_i-\theta)^2\)</span>. The corresponding conjugate prior density is the inverse-gamma
<span class="math display">\[
\begin{aligned}
p(\sigma^2)\propto (\sigma^2)^{-(\alpha+1)}e^{-\beta/\sigma^2}
\end{aligned}
\]</span>
THe convenient parameterization is as a scaled inverse-<span class="math inline">\(\chi^2\)</span> distribution with scale <span class="math inline">\(\sigma_0^2\)</span> and <span class="math inline">\(\nu_0\)</span> degrees of freedom. The prior distribution for <span class="math inline">\(\sigma^2\)</span> is taken as <span class="math inline">\(\sigma_0^2\nu_0/X\)</span>, where <span class="math inline">\(X\sim \chi_{\nu_0}^2\)</span> random variable.</p>
<p>The resulting posterior density for <span class="math inline">\(\sigma^2\)</span> is</p>
<p><span class="math display">\[
\begin{aligned}
p(\sigma^2| y) &amp;\propto p(\sigma^2)p(y|\sigma^2)\\
&amp;\propto \frac{\sigma_0^2}{\sigma^2}^{\nu_0/2+1}exp(\frac{\nu_0\sigma_0^2}{2\sigma^2})((\sigma^2)^{-n/2} exp(-n/2\frac{\nu}{\sigma^2}))\\
&amp;\propto (\sigma^2)^{-(n+\nu_0)/(2+1)}exp(\frac{-1}{2\sigma^2}(\nu_0\sigma_0^2+n\nu))\\
&amp;\text{then   } \sigma^2 | y \sim Inv.\chi^2 (\nu_0+n, \frac{\nu_0\sigma_0^2+ n\nu}{\nu_0+n})\\
\end{aligned}
\]</span>
Which is a scaled inverse-<span class="math inline">\(\chi^2\)</span> with scale equal to the degrees-of-freedom weighted average of the prior and data scales, and the d.f. equal to the sum of the prior and data degrees-of-freedom.</p>
</div>
<div id="poisson-model" class="section level3 unnumbered hasAnchor">
<h3>Poisson model<a href="cross.html#poisson-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Poisson model arises in data in the form of counts; in epidemiology studies disease incidence is modeled using Poisson framework.</p>
<p>the likelihood is
<span class="math display">\[
\begin{aligned}
p(y|\theta)&amp;= \prod_i^n \frac{1}{y_i!}\theta^{y_i}e^{-\theta}\\
&amp;=\theta^{t(y)}e^{-n\theta}\\
\end{aligned}
\]</span>
Where the sufficient statistic is t(y)=<span class="math inline">\(\sum y_i\)</span> and the likelihood in exponential family form is written as</p>
<p><span class="math display">\[
p(y|\theta)\propto e^{-n\theta}e^{t(y)log(\theta)}
\]</span>
where the natural parameter <span class="math inline">\(\phi(\theta)=log(\theta)\)</span> and the natural conjugate prior distribution is</p>
<p><span class="math display">\[
p(\theta)\propto (e^{-\theta})^{\eta}e^{\nu *log(\theta)}
\]</span>
indexed by hyperparameters (<span class="math inline">\(\eta,\nu\)</span>). We can rewrite the likelihood in the form <span class="math inline">\(\theta^a e^{-b\theta}\)</span> and so the conjugate prior must be in the form of <span class="math inline">\(p(\theta)\propto \theta^Ae^{-B\theta}\)</span> which can be re-written to follow a Gamma density as
<span class="math display">\[
p(\theta)\propto e^{-\beta\theta}\theta^{\alpha-1}
\]</span>
and this follows a Gamma(<span class="math inline">\(\alpha,\beta)\)</span> equivalent to prior total count of <span class="math inline">\(\alpha-1\)</span> in <span class="math inline">\(\beta\)</span> prior observations. The posterior is
<span class="math display">\[
\theta|y \sim Gamma(\alpha+n\bar{y}, \beta+n)
\]</span></p>
</div>
<div id="negative-binomial-distribution" class="section level3 unnumbered hasAnchor">
<h3>Negative Binomial distribution<a href="cross.html#negative-binomial-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="exercises-1" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Exercises<a href="cross.html#exercises-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="question-1" class="section level3 unnumbered hasAnchor">
<h3>Question 1<a href="cross.html#question-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>prior Beta(4,4), where a coin is tossed 10 times and heads appears fewer than 3 times. the exact posterior is Beta(4+y, 4+10-y) for y=0,1,2. Since we don’t know the observed heads, but that <span class="math inline">\(y&lt;3\)</span> we plot the posterior distributions for each possibility. For 2 heads it is closer to the prior, with posterior mean of 0.33, which is closest to the prior mean of 1/2.</p>
<p>The random event is that <span class="math inline">\(Y=(0,1,2)\)</span> and we sum all possibilities for the total likelihood.</p>
<p>The likelihood of the total event is <span class="math inline">\(\theta^0(1-\theta)^{10}+\binom{10}{1}\theta(1-\theta)^9+\binom{10}{2}\theta^2(1-\theta)^8\)</span></p>
<p>the posterior is <span class="math inline">\(\theta^3(1-\theta)^{13}+\binom{10}{1}\theta^4(1-\theta)^{12}+\binom{10}{2}\theta^5(1-\theta)^{11}\)</span></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="cross.html#cb34-1" aria-hidden="true" tabindex="-1"></a> theta<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>,<span class="at">to=</span><span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb34-2"><a href="cross.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="cross.html#cb34-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(theta,<span class="fu">dbeta</span>(theta,<span class="dv">4</span>,<span class="dv">4</span>),<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>),<span class="at">main=</span><span class="st">&#39;individual posteriors&#39;</span>) <span class="do">## prior</span></span>
<span id="cb34-4"><a href="cross.html#cb34-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">lines</span>(theta,<span class="fu">dbeta</span>(theta,<span class="dv">4</span><span class="sc">+</span><span class="dv">1</span>,<span class="dv">4</span><span class="sc">+</span><span class="dv">10-1</span>),<span class="at">lty=</span><span class="dv">2</span>) <span class="do">## 1 success</span></span>
<span id="cb34-5"><a href="cross.html#cb34-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">lines</span>(theta,<span class="fu">dbeta</span>(theta,<span class="dv">4</span><span class="sc">+</span><span class="dv">2</span>,<span class="dv">4</span><span class="sc">+</span><span class="dv">10-2</span>),<span class="at">lty=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>) <span class="do">## 2 succe</span></span>
<span id="cb34-6"><a href="cross.html#cb34-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">lines</span>(theta,<span class="fu">dbeta</span>(theta,<span class="dv">4</span>,<span class="dv">4</span><span class="sc">+</span><span class="dv">10</span>),<span class="at">lty=</span><span class="dv">4</span>,<span class="at">col=</span><span class="st">&#39;blue&#39;</span>)  <span class="do">## 0 successes</span></span>
<span id="cb34-7"><a href="cross.html#cb34-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb34-8"><a href="cross.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="fl">0.6</span>, <span class="dv">4</span>, </span>
<span id="cb34-9"><a href="cross.html#cb34-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;prior&quot;</span>, <span class="st">&quot;0 H&quot;</span>, <span class="st">&quot;1 H&quot;</span>, <span class="st">&quot;2 H&quot;</span>),</span>
<span id="cb34-10"><a href="cross.html#cb34-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">cex=</span><span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="cross.html#cb35-1" aria-hidden="true" tabindex="-1"></a>post<span class="ot">&lt;-</span> theta<span class="sc">^</span><span class="dv">3</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>theta)<span class="sc">^</span>(<span class="dv">13</span>)<span class="sc">+</span><span class="fu">choose</span>(<span class="dv">10</span>,<span class="dv">1</span>)<span class="sc">*</span>theta<span class="sc">^</span><span class="dv">4</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>theta)<span class="sc">^</span><span class="dv">12</span><span class="sc">+</span><span class="fu">choose</span>(<span class="dv">10</span>,<span class="dv">2</span>)<span class="sc">*</span>theta<span class="sc">^</span><span class="dv">5</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>theta)<span class="sc">^</span><span class="dv">11</span></span>
<span id="cb35-2"><a href="cross.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="cross.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(theta,post,<span class="at">main=</span><span class="st">&#39;total posterior Y=0,1,2&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
</div>
<div id="normal-approximation-example" class="section level3 unnumbered hasAnchor">
<h3>Normal approximation example<a href="cross.html#normal-approximation-example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For female births we have beta(438,544) we use the normal approximation. This replicates Gelman’s Figure 2.3 (a, b)</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="cross.html#cb36-1" aria-hidden="true" tabindex="-1"></a>  theta<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="at">from=</span><span class="fl">0.001</span>,<span class="at">to=</span><span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb36-2"><a href="cross.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## example births</span></span>
<span id="cb36-3"><a href="cross.html#cb36-3" aria-hidden="true" tabindex="-1"></a>   postMean <span class="ot">&lt;-</span><span class="cf">function</span>(alpha,beta,y,n){</span>
<span id="cb36-4"><a href="cross.html#cb36-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">return</span>( (alpha<span class="sc">+</span>y)<span class="sc">/</span>(alpha<span class="sc">+</span>beta<span class="sc">+</span>n))</span>
<span id="cb36-5"><a href="cross.html#cb36-5" aria-hidden="true" tabindex="-1"></a>   } </span>
<span id="cb36-6"><a href="cross.html#cb36-6" aria-hidden="true" tabindex="-1"></a>   postVar<span class="ot">&lt;-</span><span class="cf">function</span>(alpha,beta,y,n){</span>
<span id="cb36-7"><a href="cross.html#cb36-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">return</span>( ((alpha<span class="sc">+</span>y)<span class="sc">*</span>(beta<span class="sc">+</span>n<span class="sc">-</span>y))<span class="sc">/</span>( (alpha<span class="sc">+</span>beta<span class="sc">+</span>n)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(alpha<span class="sc">+</span>beta<span class="sc">+</span>n<span class="sc">+</span><span class="dv">1</span>)) )</span>
<span id="cb36-8"><a href="cross.html#cb36-8" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb36-9"><a href="cross.html#cb36-9" aria-hidden="true" tabindex="-1"></a>   sdnorm<span class="ot">&lt;-</span><span class="fu">sqrt</span>(<span class="fu">postVar</span>(<span class="dv">438</span>,<span class="dv">544</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb36-10"><a href="cross.html#cb36-10" aria-hidden="true" tabindex="-1"></a>   logitMean<span class="ot">&lt;-</span><span class="fu">log</span>( <span class="fu">postMean</span>(<span class="dv">438</span>,<span class="dv">544</span>,<span class="dv">0</span>,<span class="dv">0</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">postMean</span>(<span class="dv">438</span>,<span class="dv">544</span>,<span class="dv">0</span>,<span class="dv">0</span>)))</span>
<span id="cb36-11"><a href="cross.html#cb36-11" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb36-12"><a href="cross.html#cb36-12" aria-hidden="true" tabindex="-1"></a>  logitTheta<span class="ot">&lt;-</span><span class="fu">log</span>(theta<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>theta))</span>
<span id="cb36-13"><a href="cross.html#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="cross.html#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb36-15"><a href="cross.html#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(theta,<span class="fu">dbeta</span>(theta,<span class="dv">438</span>,<span class="dv">544</span>),<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">0.35</span>,<span class="fl">0.55</span>),<span class="at">main=</span><span class="st">&quot;posterior beta&quot;</span>) <span class="do">## prior</span></span>
<span id="cb36-16"><a href="cross.html#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v=</span><span class="fl">0.446</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb36-17"><a href="cross.html#cb36-17" aria-hidden="true" tabindex="-1"></a>  draws<span class="ot">&lt;-</span><span class="fu">rbeta</span>(<span class="dv">1000</span>,<span class="dv">438</span>,<span class="dv">544</span>)</span>
<span id="cb36-18"><a href="cross.html#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(logitTheta,<span class="fu">dnorm</span>(logitTheta,<span class="at">mean =</span>logitMean, <span class="at">sd=</span><span class="fu">sd</span>(<span class="fu">log</span>(draws<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>draws))) ),<span class="at">type=</span><span class="st">&#39;l&#39;</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">0.1</span>),<span class="at">main=</span><span class="st">&quot;Normal approx.&quot;</span>) <span class="do">## prior</span></span>
<span id="cb36-19"><a href="cross.html#cb36-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v=</span><span class="sc">-</span><span class="fl">0.22</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="question-3" class="section level3 unnumbered hasAnchor">
<h3>Question 3<a href="cross.html#question-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The prior predictive distributions for the number of 6’s in a fair roll, tossed 1,000 times will follow a beta distribution. Let y be the number of 6’s in 1000 rolls of fair die, the probability for a 6 is 1/6, so the number of 6’s (successes) in this trial is approximateley 167, and 833 failures as the prior prediction. with probabiliy of success (1/6).</p>
<p>We plot the beta distribution of the expected number of heads in 1000 tosses.</p>
<p>The normal approximation for the prior prediction uses the binomial distribution is <span class="math inline">\(\mu = n*p = 167\)</span> and $^2 = npq $= 138.89 <span class="math inline">\(\sim N(167, 138.89)\)</span></p>
<p>The normal approximation shows the probability of heads in a given 1000 tosses, using a non-informative prior beta(167,833) which has a prior predictive mean of <span class="math inline">\(exp(-1.79)/(1+exp(-1.79)) = 0.143\)</span>. This is not the same for number of success in 1000 tosses.</p>
<p>We find the probability distribution of a given success and the prior probability predictive interval follows a beta with 95% (0.12,0.17) for hte probability of rolling a 6</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="cross.html#cb37-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## based on normal approximation sketch the distribution of y</span></span>
<span id="cb37-2"><a href="cross.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for normal we use the logit transform</span></span>
<span id="cb37-3"><a href="cross.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## n = 1,000</span></span>
<span id="cb37-4"><a href="cross.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## first lets construct a beta distribution.</span></span>
<span id="cb37-5"><a href="cross.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## let the prior be beta(4,4) or even beta(1,1)</span></span>
<span id="cb37-6"><a href="cross.html#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="do">## prior prediction</span></span>
<span id="cb37-7"><a href="cross.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  theta<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">100</span>,<span class="at">to=</span><span class="dv">250</span>,<span class="at">by=</span><span class="fl">0.11</span>)</span>
<span id="cb37-8"><a href="cross.html#cb37-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plot</span>(theta,<span class="fu">dnorm</span>(theta,<span class="dv">167</span>,<span class="fu">sqrt</span>(<span class="fl">138.89</span>)),<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">main=</span><span class="st">&quot;prior normal prediction for binomial likelihood&quot;</span>) <span class="do">## prior</span></span>
<span id="cb37-9"><a href="cross.html#cb37-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">lines</span>(theta,<span class="fu">dbinom</span>(<span class="fu">round</span>(theta),<span class="at">size=</span><span class="dv">1000</span>,<span class="at">prob=</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>)),<span class="at">main=</span><span class="st">&quot;prior binom prediction for binomial likelihood&quot;</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>) <span class="do">## prior</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="cross.html#cb38-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## posterior prediction (normal).</span></span>
<span id="cb38-2"><a href="cross.html#cb38-2" aria-hidden="true" tabindex="-1"></a>     <span class="do">## assume p=1/6 we expect 167 successes under likelihood.</span></span>
<span id="cb38-3"><a href="cross.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="do">## simulation     </span></span>
<span id="cb38-4"><a href="cross.html#cb38-4" aria-hidden="true" tabindex="-1"></a>     priordraws<span class="ot">&lt;-</span><span class="fu">sample</span>(theta,<span class="at">size=</span><span class="dv">1000</span>,<span class="at">replace=</span>T,<span class="at">prob=</span><span class="fu">dnorm</span>(theta,<span class="dv">167</span>,<span class="fu">sqrt</span>(<span class="fl">138.89</span>)))</span>
<span id="cb38-5"><a href="cross.html#cb38-5" aria-hidden="true" tabindex="-1"></a>     priorpred<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">1000</span>,<span class="at">mean=</span>priordraws,<span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fl">138.89</span>))</span>
<span id="cb38-6"><a href="cross.html#cb38-6" aria-hidden="true" tabindex="-1"></a>     <span class="do">## prior prediction interval</span></span>
<span id="cb38-7"><a href="cross.html#cb38-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">quantile</span>(priorpred,<span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.95</span>))</span></code></pre></div>
<pre><code>##       5%      25%      50%      75%      95% 
## 138.3767 155.6468 167.1006 178.5144 195.9389</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="cross.html#cb40-1" aria-hidden="true" tabindex="-1"></a>     <span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.95</span>),<span class="dv">167</span>,<span class="fu">sqrt</span>(<span class="fl">138.89</span>))</span></code></pre></div>
<pre><code>## [1] 147.6151 159.0510 167.0000 174.9490 186.3849</code></pre>
</div>
<div id="question-4" class="section level3 unnumbered hasAnchor">
<h3>Question 4<a href="cross.html#question-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We have a mixture of 3 normal distributions, and show the central intervals for 5,25,50,75, and 95<span class="math inline">\(\%\)</span> predictive probabilities. The question gives <span class="math inline">\(\theta\)</span> as the probability of a 6 on a die, possibly unfair, in 1,000 tosses. we have <span class="math inline">\(\theta= 1/12,1/6, 1/4\)</span> types of biased die. Using the normal approximation, the predictive prior probability is <span class="math inline">\(\sum_{\theta}p(\theta)p(y| \theta)\)</span> where the likelihood is approximated using a normal distribution <span class="math inline">\(\mu = n*\theta_i, \sigma = n*\theta_i(1-\theta_i)\)</span></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="cross.html#cb42-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1000</span>)<span class="sc">-</span><span class="fl">0.5</span> <span class="co"># continuity correction.</span></span>
<span id="cb42-2"><a href="cross.html#cb42-2" aria-hidden="true" tabindex="-1"></a>theta<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)</span>
<span id="cb42-3"><a href="cross.html#cb42-3" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">1000</span></span>
<span id="cb42-4"><a href="cross.html#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="cross.html#cb42-5" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span><span class="fu">dnorm</span>(x,<span class="at">mean=</span>n<span class="sc">*</span>theta[<span class="dv">1</span>],<span class="at">sd=</span><span class="fu">sqrt</span>(n<span class="sc">*</span>theta[<span class="dv">1</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>theta[<span class="dv">1</span>]))  )</span>
<span id="cb42-6"><a href="cross.html#cb42-6" aria-hidden="true" tabindex="-1"></a>b<span class="ot">&lt;-</span><span class="fu">dnorm</span>(x,<span class="at">mean=</span>n<span class="sc">*</span>theta[<span class="dv">2</span>],<span class="at">sd=</span><span class="fu">sqrt</span>(n<span class="sc">*</span>theta[<span class="dv">2</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>theta[<span class="dv">2</span>]))  )</span>
<span id="cb42-7"><a href="cross.html#cb42-7" aria-hidden="true" tabindex="-1"></a>c<span class="ot">&lt;-</span><span class="fu">dnorm</span>(x,<span class="at">mean=</span>n<span class="sc">*</span>theta[<span class="dv">3</span>],<span class="at">sd=</span><span class="fu">sqrt</span>(n<span class="sc">*</span>theta[<span class="dv">3</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>theta[<span class="dv">3</span>]))  )</span>
<span id="cb42-8"><a href="cross.html#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="cross.html#cb42-9" aria-hidden="true" tabindex="-1"></a> <span class="do">## posterior computation</span></span>
<span id="cb42-10"><a href="cross.html#cb42-10" aria-hidden="true" tabindex="-1"></a> <span class="do">##p(y) =  p(y| theta1 )*p(theta1)+ p(y| theta2 )*p(theta2)+ p(y| theta3 )*p(theta3)</span></span>
<span id="cb42-11"><a href="cross.html#cb42-11" aria-hidden="true" tabindex="-1"></a> <span class="co"># total law of probability</span></span>
<span id="cb42-12"><a href="cross.html#cb42-12" aria-hidden="true" tabindex="-1"></a>mypost<span class="ot">&lt;-</span>a<span class="sc">*</span><span class="fl">0.25</span><span class="sc">+</span>b<span class="sc">*</span><span class="fl">0.5</span><span class="sc">+</span>c<span class="sc">*</span><span class="fl">0.25</span></span>
<span id="cb42-13"><a href="cross.html#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="cross.html#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="do">## prior pred  p(y) = p(y|theta)*p(theta) / p(theta| y)</span></span>
<span id="cb42-15"><a href="cross.html#cb42-15" aria-hidden="true" tabindex="-1"></a>mypri<span class="ot">&lt;-</span>mypost</span>
<span id="cb42-16"><a href="cross.html#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="cross.html#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mypri) <span class="do">## sums to 1 it is a distribution</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="cross.html#cb44-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb44-2"><a href="cross.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,mypri,<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">main=</span><span class="st">&#39;predictive prior number of heads&#39;</span>)</span>
<span id="cb44-3"><a href="cross.html#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="cross.html#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="cross.html#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="cross.html#cb44-6" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">x=</span>x,<span class="at">p=</span>mypri)</span>
<span id="cb44-7"><a href="cross.html#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="cross.html#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="do">## highest probability interval</span></span>
<span id="cb44-9"><a href="cross.html#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 95%</span></span>
<span id="cb44-10"><a href="cross.html#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="cross.html#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,mypri,<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">main=</span><span class="st">&#39; 95% predictive prior number of heads&#39;</span>)</span>
<span id="cb44-12"><a href="cross.html#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">max</span>(data[<span class="fu">which</span>(<span class="fu">cumsum</span>(data<span class="sc">$</span>p)<span class="sc">&lt;</span><span class="fl">0.025</span>),<span class="dv">1</span>])</span>
<span id="cb44-13"><a href="cross.html#cb44-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-14"><a href="cross.html#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">max</span>(data[<span class="fu">which</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cumsum</span>(data<span class="sc">$</span>p)<span class="sc">&gt;</span><span class="fl">0.025</span>),<span class="dv">1</span>]))</span>
<span id="cb44-15"><a href="cross.html#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="cross.html#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,mypri,<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">main=</span><span class="st">&#39;75% predictive prior number of heads&#39;</span>)</span>
<span id="cb44-17"><a href="cross.html#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">max</span>(data[<span class="fu">which</span>(<span class="fu">cumsum</span>(data<span class="sc">$</span>p)<span class="sc">&lt;</span><span class="fl">0.125</span>),<span class="dv">1</span>]))</span>
<span id="cb44-18"><a href="cross.html#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">max</span>(data[<span class="fu">which</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cumsum</span>(data<span class="sc">$</span>p)<span class="sc">&gt;</span><span class="fl">0.125</span>),<span class="dv">1</span>])</span>
<span id="cb44-19"><a href="cross.html#cb44-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-20"><a href="cross.html#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="cross.html#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,mypri,<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">main=</span><span class="st">&#39;50% predictive prior number of heads&#39;</span>)</span>
<span id="cb44-22"><a href="cross.html#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">max</span>(data[<span class="fu">which</span>(<span class="fu">cumsum</span>(data<span class="sc">$</span>p)<span class="sc">&lt;</span><span class="fl">0.25</span>),<span class="dv">1</span>]))</span>
<span id="cb44-23"><a href="cross.html#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">max</span>(data[<span class="fu">which</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cumsum</span>(data<span class="sc">$</span>p)<span class="sc">&gt;</span><span class="fl">0.25</span>),<span class="dv">1</span>])</span>
<span id="cb44-24"><a href="cross.html#cb44-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-25"><a href="cross.html#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="cross.html#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,mypri,<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">main=</span><span class="st">&#39;25% predictive prior number of heads&#39;</span>)</span>
<span id="cb44-27"><a href="cross.html#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">max</span>(data[<span class="fu">which</span>(<span class="fu">cumsum</span>(data<span class="sc">$</span>p)<span class="sc">&lt;</span><span class="fl">0.375</span>),<span class="dv">1</span>]))</span>
<span id="cb44-28"><a href="cross.html#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">max</span>(data[<span class="fu">which</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cumsum</span>(data<span class="sc">$</span>p)<span class="sc">&gt;</span><span class="fl">0.375</span>),<span class="dv">1</span>])</span>
<span id="cb44-29"><a href="cross.html#cb44-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-30"><a href="cross.html#cb44-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-31"><a href="cross.html#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,mypri,<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">main=</span><span class="st">&#39;5% predictive prior number of heads&#39;</span>)</span>
<span id="cb44-32"><a href="cross.html#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">max</span>(data[<span class="fu">which</span>(<span class="fu">cumsum</span>(data<span class="sc">$</span>p)<span class="sc">&lt;</span><span class="fl">0.475</span>),<span class="dv">1</span>]))</span>
<span id="cb44-33"><a href="cross.html#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">max</span>(data[<span class="fu">which</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">cumsum</span>(data<span class="sc">$</span>p)<span class="sc">&gt;</span><span class="fl">0.475</span>),<span class="dv">1</span>])</span>
<span id="cb44-34"><a href="cross.html#cb44-34" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="question-7" class="section level3 unnumbered hasAnchor">
<h3>Question 7<a href="cross.html#question-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><ol style="list-style-type: lower-alpha">
<li>for the binomial likelihood <span class="math inline">\(y\sim Bin(n,\theta)\)</span>, show that p(<span class="math inline">\(\theta)\propto \theta^-1(1-\theta)^-1\)</span> is the uniform prior for the natural parameter of the exponential family.</li>
</ol></li>
<li>first we write the binomial likelihood in exponential family form, note that we are not deriving the posterior of any function, but just studying the likelihood.</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
p(y|\theta) &amp;= \theta^y(1-\theta)^{n-y}\\
\implies log(p)&amp;= ylog(\theta/(1-\theta))+nlog(1-\theta) \\
\implies p(y|\theta) &amp;= exp(y*log(\theta/(1-\theta)))*g(\theta)\\
\text{hence } \phi(\theta)= log(\theta/1-\theta), \text{  and we&#39;re given uniformity  } p(\phi(\theta))\propto 1\\
\end{aligned}
\]</span>
Inverting <span class="math inline">\(\phi(\theta)=log(\theta/1-\theta)\)</span> yields <span class="math inline">\(\theta=\frac{e^\phi}{1+e^\phi}\)</span> and we know that p(<span class="math inline">\(\phi)\propto 1\)</span>. Using the jacobian we can derive <span class="math inline">\(p(\theta)=p(\phi)\frac{d\phi}{d\theta}\)</span> shown as</p>
<p><span class="math display">\[
\begin{aligned}
p(\theta)&amp;=p(\phi)\frac{d\phi}{d\theta}\\
&amp;= p(\phi)d/d\theta (log(\theta/1-\theta))\\
&amp;\propto (1) (1-\theta / \theta)(1/(1-\theta)^2) \\
&amp;= 1/\theta *(1/1-\theta)
\end{aligned}
\]</span></p>
</div>
<div id="question-8-normal-distribution-with-unknown-mean" class="section level3 unnumbered hasAnchor">
<h3>Question 8 (Normal distribution with unknown mean)<a href="cross.html#question-8-normal-distribution-with-unknown-mean" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A random sample of n students is drawn from a large population, and weights are measured. The average height of the n sampled students is <span class="math inline">\(\bar{y}= 150\)</span> lbs. Assume the weights in the population are normally distribution with unknown mean, <span class="math inline">\(\theta\)</span>, and known standard deviation 20 lbs. Suppose the prior for <span class="math inline">\(\theta \sim N(180, 40^2)\)</span></p>
<ul>
<li><ol style="list-style-type: lower-alpha">
<li>For known variance, the limit of the posterior is <span class="math inline">\(p(\theta,y)\approx N(\theta| \bar{y}, \sigma^2/n)\)</span>. And the direct formulation is <span class="math inline">\(p(\theta | \bar{y})= N(\theta | \mu_n,\tau_n^2).\)</span> using equations 2.12.</li>
</ol></li>
<li><ol start="2" style="list-style-type: lower-alpha">
<li>For a posterior predictive interval, the marginal distribution for new data <span class="math inline">\(p(\tilde{y} | y) \sim N(\mu_n, \sigma^2+\tau_n^2)\)</span></li>
</ol></li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="cross.html#cb45-1" aria-hidden="true" tabindex="-1"></a>mu_n<span class="ot">&lt;-</span><span class="cf">function</span>(mu0,ybar,n,tau02,sigma2){</span>
<span id="cb45-2"><a href="cross.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  mun<span class="ot">&lt;-</span> (mu0<span class="sc">/</span>tau02 <span class="sc">+</span> (ybar<span class="sc">*</span>n)<span class="sc">/</span>sigma2)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span>tau02 <span class="sc">+</span> n<span class="sc">/</span>sigma2)</span>
<span id="cb45-3"><a href="cross.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mun)</span>
<span id="cb45-4"><a href="cross.html#cb45-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-5"><a href="cross.html#cb45-5" aria-hidden="true" tabindex="-1"></a>taun2<span class="ot">&lt;-</span><span class="cf">function</span>(tau02,n,sigma2){</span>
<span id="cb45-6"><a href="cross.html#cb45-6" aria-hidden="true" tabindex="-1"></a>  inv.taun2<span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>tau02 <span class="sc">+</span>n<span class="sc">/</span>sigma2</span>
<span id="cb45-7"><a href="cross.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">1</span><span class="sc">/</span>inv.taun2)</span>
<span id="cb45-8"><a href="cross.html#cb45-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li><ol start="3" style="list-style-type: lower-alpha">
<li>Here we give the posterior interval and predictive interval for n=10</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="cross.html#cb46-1" aria-hidden="true" tabindex="-1"></a>ybar<span class="ot">=</span><span class="dv">150</span></span>
<span id="cb46-2"><a href="cross.html#cb46-2" aria-hidden="true" tabindex="-1"></a>sigma2<span class="ot">=</span><span class="dv">20</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb46-3"><a href="cross.html#cb46-3" aria-hidden="true" tabindex="-1"></a>mu0<span class="ot">=</span><span class="dv">180</span></span>
<span id="cb46-4"><a href="cross.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  tau02<span class="ot">=</span><span class="dv">40</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb46-5"><a href="cross.html#cb46-5" aria-hidden="true" tabindex="-1"></a>  n<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb46-6"><a href="cross.html#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="cross.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="do">## posterior interval n=10</span></span>
<span id="cb46-8"><a href="cross.html#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lower&lt;-round(qnorm(0.025,mu_n(mu0,ybar,tau02,10,sigma2),sd=sqrt(taun2(tau02,10,sigma2))),2)</span></span>
<span id="cb46-9"><a href="cross.html#cb46-9" aria-hidden="true" tabindex="-1"></a>    upper<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>),<span class="fu">mu_n</span>(mu0,ybar,tau02,<span class="dv">10</span>,sigma2),<span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fu">taun2</span>(tau02,<span class="dv">10</span>,sigma2))),<span class="dv">2</span>)</span>
<span id="cb46-10"><a href="cross.html#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="cross.html#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;posterior interval n=10: &quot;</span>,upper[<span class="dv">1</span>],<span class="st">&quot; &quot;</span>,upper[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## posterior interval n=10: 138.49 162.98</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="cross.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">## posterior predictive interval</span></span>
<span id="cb48-2"><a href="cross.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  upper2<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>),<span class="fu">mu_n</span>(mu0,ybar,tau02,<span class="dv">10</span>,sigma2),<span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fu">taun2</span>(tau02,<span class="dv">10</span>,sigma2)<span class="sc">+</span>sigma2) ),<span class="dv">2</span>)</span>
<span id="cb48-3"><a href="cross.html#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="cross.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;posterior predictive interval n=10: &quot;</span>,upper2[<span class="dv">1</span>],<span class="st">&quot; &quot;</span>,upper2[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## posterior predictive interval n=10: 109.66 191.8</code></pre>
<ul>
<li><ol start="4" style="list-style-type: lower-alpha">
<li>the posterior and predictive for n=100</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="cross.html#cb50-1" aria-hidden="true" tabindex="-1"></a> lower<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">qnorm</span>(<span class="fl">0.025</span>,<span class="fu">mu_n</span>(mu0,ybar,tau02,<span class="dv">100</span>,sigma2),<span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fu">taun2</span>(tau02,<span class="dv">100</span>,sigma2))),<span class="dv">2</span>)</span>
<span id="cb50-2"><a href="cross.html#cb50-2" aria-hidden="true" tabindex="-1"></a>    upper<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">qnorm</span>(<span class="fl">0.975</span>,<span class="fu">mu_n</span>(mu0,ybar,tau02,<span class="dv">100</span>,sigma2),<span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fu">taun2</span>(tau02,<span class="dv">100</span>,sigma2))),<span class="dv">2</span>)</span>
<span id="cb50-3"><a href="cross.html#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="cross.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;posterior interval n=100: &quot;</span>,lower,<span class="st">&quot; &quot;</span>,upper)</span></code></pre></div>
<pre><code>## posterior interval n=100: 146.16 153.99</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="cross.html#cb52-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## this approximately equals the limit</span></span>
<span id="cb52-2"><a href="cross.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;The asymptotic approximation&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The asymptotic approximation&quot;</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="cross.html#cb54-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>),<span class="at">mean=</span><span class="dv">150</span>, sigma2<span class="sc">/</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 142.1601 157.8399</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="cross.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="do">## posterior predictive interval</span></span>
<span id="cb56-2"><a href="cross.html#cb56-2" aria-hidden="true" tabindex="-1"></a> lower2<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">qnorm</span>(<span class="fl">0.025</span>,<span class="fu">mu_n</span>(mu0,ybar,tau02,<span class="dv">100</span>,sigma2),<span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fu">taun2</span>(tau02,<span class="dv">100</span>,sigma2)<span class="sc">+</span>sigma2) ),<span class="dv">2</span>)</span>
<span id="cb56-3"><a href="cross.html#cb56-3" aria-hidden="true" tabindex="-1"></a>    upper2<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">qnorm</span>(<span class="fl">0.975</span>,<span class="fu">mu_n</span>(mu0,ybar,tau02,<span class="dv">100</span>,sigma2),<span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fu">taun2</span>(tau02,<span class="dv">100</span>,sigma2)<span class="sc">+</span>sigma2) ),<span class="dv">2</span>)</span>
<span id="cb56-4"><a href="cross.html#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="cross.html#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;posterior predictive interval n=100: &quot;</span>,lower2,<span class="st">&quot; &quot;</span>,upper2)</span></code></pre></div>
<pre><code>## posterior predictive interval n=100: 110.68 189.47</code></pre>
</div>
<div id="question-10" class="section level3 unnumbered hasAnchor">
<h3>Question 10<a href="cross.html#question-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose there are N cable cars numbered sequentially 1 to N. You see a car at random labeled 203 and wish to estimate N. (a) assume the prior follows Geo(1/100) what is the posterior for N?</p>
<ul>
<li><ol style="list-style-type: lower-alpha">
<li>The car X=203 was observed, and the likelihood of this observation (data) is uniform p(<span class="math inline">\(X|N=203)=1/N\)</span> which assumes each car is equally likely. So the posterior <span class="math inline">\(p(N|X) = (1/N)(1/100)(99/100)^{N-1}\)</span>. So the posterior is proportional to <span class="math inline">\((1/N)(99/100)^{N-1}\)</span> with <span class="math inline">\(N\geq 203\)</span>.</li>
</ol></li>
<li>what is the posterior mean and std. deviation for N?.
we use Bayes’ theorem <span class="math inline">\(p(N|X) = \frac{p(X|N)p(N)}{p(X)}\)</span>. And use a computer to approximation p(X) which is approximately 0.0471 (ignoring constant).
the infinite series <span class="math inline">\(\sum_{n=203}^\infty (1/n)(99/100)^{n-1}\)</span> converges by using the ratio test with <span class="math inline">\(\rho&lt;1\)</span> to $.
The posterior mean and standard deviation is 279.09 a.nd 79.96, which was evaluated using the posterior distribution <span class="math inline">\(p(N|X)\)</span> defined as
<span class="math display">\[
p(N|X) \propto \frac{(1/N)(99/100)^{N-1}}{p(X)}  
\]</span></li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="cross.html#cb58-1" aria-hidden="true" tabindex="-1"></a> totalSum<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb58-2"><a href="cross.html#cb58-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb58-3"><a href="cross.html#cb58-3" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">203</span><span class="sc">:</span><span class="dv">30000</span>){</span>
<span id="cb58-4"><a href="cross.html#cb58-4" aria-hidden="true" tabindex="-1"></a>  sum_i<span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>i)<span class="sc">*</span>(<span class="dv">99</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span>(i<span class="dv">-1</span>)</span>
<span id="cb58-5"><a href="cross.html#cb58-5" aria-hidden="true" tabindex="-1"></a>  totalSum<span class="ot">=</span> totalSum<span class="sc">+</span>sum_i</span>
<span id="cb58-6"><a href="cross.html#cb58-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-7"><a href="cross.html#cb58-7" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb58-8"><a href="cross.html#cb58-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(totalSum)</span></code></pre></div>
<pre><code>## [1] 0.04705084</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="cross.html#cb60-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## approximate the distribution</span></span>
<span id="cb60-2"><a href="cross.html#cb60-2" aria-hidden="true" tabindex="-1"></a> px<span class="ot">&lt;-</span>totalSum</span>
<span id="cb60-3"><a href="cross.html#cb60-3" aria-hidden="true" tabindex="-1"></a> X<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">203</span>,<span class="dv">300000</span>)</span>
<span id="cb60-4"><a href="cross.html#cb60-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb60-5"><a href="cross.html#cb60-5" aria-hidden="true" tabindex="-1"></a> dpx<span class="ot">&lt;-</span><span class="cf">function</span>(N,px){</span>
<span id="cb60-6"><a href="cross.html#cb60-6" aria-hidden="true" tabindex="-1"></a>   dd<span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span>px)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span>N)<span class="sc">*</span>(<span class="dv">99</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span>(N<span class="dv">-1</span>)</span>
<span id="cb60-7"><a href="cross.html#cb60-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb60-8"><a href="cross.html#cb60-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(dd)</span>
<span id="cb60-9"><a href="cross.html#cb60-9" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb60-10"><a href="cross.html#cb60-10" aria-hidden="true" tabindex="-1"></a> <span class="do">## the posterior mean is</span></span>
<span id="cb60-11"><a href="cross.html#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## E(X) = x*f(x)</span></span>
<span id="cb60-12"><a href="cross.html#cb60-12" aria-hidden="true" tabindex="-1"></a> postMean<span class="ot">&lt;-</span><span class="cf">function</span>(N,px){</span>
<span id="cb60-13"><a href="cross.html#cb60-13" aria-hidden="true" tabindex="-1"></a>   fx<span class="ot">&lt;-</span> <span class="fu">dpx</span>(N,px)</span>
<span id="cb60-14"><a href="cross.html#cb60-14" aria-hidden="true" tabindex="-1"></a>   ex<span class="ot">&lt;-</span> N<span class="sc">*</span>fx</span>
<span id="cb60-15"><a href="cross.html#cb60-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(ex)</span>
<span id="cb60-16"><a href="cross.html#cb60-16" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb60-17"><a href="cross.html#cb60-17" aria-hidden="true" tabindex="-1"></a>  EX<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">postMean</span>(X,px))</span>
<span id="cb60-18"><a href="cross.html#cb60-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-19"><a href="cross.html#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="do">## posterior variance</span></span>
<span id="cb60-20"><a href="cross.html#cb60-20" aria-hidden="true" tabindex="-1"></a>   <span class="do">## VX = EX^2 - (EX)^2</span></span>
<span id="cb60-21"><a href="cross.html#cb60-21" aria-hidden="true" tabindex="-1"></a>postMean.sq<span class="ot">&lt;-</span><span class="cf">function</span>(N,px){</span>
<span id="cb60-22"><a href="cross.html#cb60-22" aria-hidden="true" tabindex="-1"></a>   fx<span class="ot">&lt;-</span> <span class="fu">dpx</span>(N,px)</span>
<span id="cb60-23"><a href="cross.html#cb60-23" aria-hidden="true" tabindex="-1"></a>   ex2<span class="ot">&lt;-</span> N<span class="sc">*</span>N<span class="sc">*</span>fx</span>
<span id="cb60-24"><a href="cross.html#cb60-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(ex2)</span>
<span id="cb60-25"><a href="cross.html#cb60-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-26"><a href="cross.html#cb60-26" aria-hidden="true" tabindex="-1"></a> <span class="do">## the variance term has to be evaluated at smaller limit to avoid overflow</span></span>
<span id="cb60-27"><a href="cross.html#cb60-27" aria-hidden="true" tabindex="-1"></a>sdX<span class="ot">&lt;-</span><span class="fu">sqrt</span>(<span class="fu">sum</span>(<span class="fu">postMean.sq</span>(<span class="fu">seq</span>(<span class="dv">203</span>,<span class="dv">35000</span>),px))<span class="sc">-</span>(EX)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb60-28"><a href="cross.html#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;posterior mean and sd is:&quot;</span>, <span class="fu">round</span>(EX,<span class="dv">2</span>),<span class="st">&quot; &quot;</span>,<span class="fu">round</span>(sdX,<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## posterior mean and sd is:279.09 79.96</code></pre>
<ul>
<li><ol start="2" style="list-style-type: lower-alpha">
<li>we use a simulation to estimate the posterior. We sample with replacement, with a distribution size equal to a large number (N), with probability of observing a number equal to the posterior distribution. The empirial mean and std.dev are 280.5, and 80.9</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="cross.html#cb62-1" aria-hidden="true" tabindex="-1"></a> N<span class="ot">&lt;-</span><span class="dv">203</span><span class="sc">:</span><span class="dv">100000</span></span>
<span id="cb62-2"><a href="cross.html#cb62-2" aria-hidden="true" tabindex="-1"></a> Nsim<span class="ot">&lt;-</span><span class="dv">10000</span></span>
<span id="cb62-3"><a href="cross.html#cb62-3" aria-hidden="true" tabindex="-1"></a> unnorm.post<span class="ot">&lt;-</span>(<span class="dv">1</span><span class="sc">/</span>N)<span class="sc">*</span>(<span class="dv">99</span><span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span>(N<span class="dv">-10</span>)</span>
<span id="cb62-4"><a href="cross.html#cb62-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">mean</span>(<span class="fu">sample</span>(N,<span class="at">size=</span>Nsim,<span class="at">prob=</span>unnorm.post,<span class="at">replace=</span>T))</span></code></pre></div>
<pre><code>## [1] 278.9321</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="cross.html#cb64-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">sd</span>(<span class="fu">sample</span>(N,<span class="at">size=</span>Nsim,<span class="at">prob=</span>unnorm.post,<span class="at">replace=</span>T))</span></code></pre></div>
<pre><code>## [1] 80.54238</code></pre>
<ul>
<li><ol start="3" style="list-style-type: lower-alpha">
<li>we can use a uniform prior <span class="math inline">\(p(N) = 1/N\)</span> with a geometric likelihood p(<span class="math inline">\(X|N)=(1/100)(99/100)^(N-1)\)</span> which will not change the result. We can also change the parameter p to be distributed under a binomial model.</li>
</ol></li>
</ul>
</div>
<div id="question-11" class="section level3 unnumbered hasAnchor">
<h3>Question 11<a href="cross.html#question-11" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>suppose y1,…,y5 are iid Cauchy(<span class="math inline">\(\theta,1\)</span>) r.vs. and the prior distribution for<span class="math inline">\(\theta \sim U[0,100]\)</span>. the given observations are y=43,44,45,46.5,47.5.</p>
<ul>
<li><ol style="list-style-type: lower-alpha">
<li>compute the unnormalized posterior density on a grid of points <span class="math inline">\(\theta=0 1/m, 2/m, ... 100\)</span>. using the grid approximation, compute and plot the posterior density as a function of <span class="math inline">\(\theta\)</span></li>
</ol></li>
</ul>
<p>for the likelihood <span class="math inline">\(L(\theta | y) = \prod_{i=1}^n f(y_i|\theta)\)</span> requires the product of <span class="math inline">\(y\)</span> for a given theta. this was a mistake i made in the first attempt. The posterior is <span class="math inline">\(p(\theta|y) = L(\theta |y)p(\theta)\)</span> wher p(<span class="math inline">\(\theta)= 1/100\)</span></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="cross.html#cb66-1" aria-hidden="true" tabindex="-1"></a> y<span class="ot">=</span> <span class="fu">c</span>(<span class="dv">43</span>,<span class="dv">44</span>,<span class="dv">45</span>,<span class="fl">46.5</span>,<span class="fl">47.5</span>)</span>
<span id="cb66-2"><a href="cross.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="do">## previous editions values for checking</span></span>
<span id="cb66-3"><a href="cross.html#cb66-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#y=c(-2,-1,0,1.5,2.5)</span></span>
<span id="cb66-4"><a href="cross.html#cb66-4" aria-hidden="true" tabindex="-1"></a>  step<span class="ot">=</span><span class="fl">0.01</span></span>
<span id="cb66-5"><a href="cross.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co">#theta&lt;-seq(from=0,to=100000)/m</span></span>
<span id="cb66-6"><a href="cross.html#cb66-6" aria-hidden="true" tabindex="-1"></a> theta<span class="ot">&lt;-</span><span class="fu">seq</span>(step<span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">-</span>step<span class="sc">/</span><span class="dv">2</span>,step)</span>
<span id="cb66-7"><a href="cross.html#cb66-7" aria-hidden="true" tabindex="-1"></a> <span class="do">## p(theta | y) ~ p(y|theta)*p(theta)</span></span>
<span id="cb66-8"><a href="cross.html#cb66-8" aria-hidden="true" tabindex="-1"></a> dens<span class="ot">&lt;-</span><span class="cf">function</span>(y,th){</span>
<span id="cb66-9"><a href="cross.html#cb66-9" aria-hidden="true" tabindex="-1"></a>   dens0<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb66-10"><a href="cross.html#cb66-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(th)){</span>
<span id="cb66-11"><a href="cross.html#cb66-11" aria-hidden="true" tabindex="-1"></a>     dens0<span class="ot">&lt;-</span><span class="fu">c</span>(dens0, <span class="fu">prod</span> (<span class="fu">dcauchy</span>(y, th[i],<span class="dv">1</span>)))</span>
<span id="cb66-12"><a href="cross.html#cb66-12" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb66-13"><a href="cross.html#cb66-13" aria-hidden="true" tabindex="-1"></a>   dens0</span>
<span id="cb66-14"><a href="cross.html#cb66-14" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb66-15"><a href="cross.html#cb66-15" aria-hidden="true" tabindex="-1"></a> <span class="co">#dens(y,theta)</span></span>
<span id="cb66-16"><a href="cross.html#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># L(theta | y) = prod_{i=1}^n  f(y| theta)  we need the product term here.</span></span>
<span id="cb66-17"><a href="cross.html#cb66-17" aria-hidden="true" tabindex="-1"></a> unnorm.post<span class="ot">&lt;-</span><span class="fu">sapply</span>(theta, <span class="cf">function</span>(x)  <span class="fu">prod</span>(<span class="fu">dcauchy</span>(y,<span class="at">location=</span>x,<span class="at">scale=</span><span class="dv">1</span>) )) <span class="do">## un norm post</span></span>
<span id="cb66-18"><a href="cross.html#cb66-18" aria-hidden="true" tabindex="-1"></a>   <span class="do">## p(theta| y ) = p(y| theta)p(theta)  where p(theta) is U(0,100)</span></span>
<span id="cb66-19"><a href="cross.html#cb66-19" aria-hidden="true" tabindex="-1"></a> post<span class="ot">&lt;-</span>unnorm.post<span class="sc">/</span>(step<span class="sc">*</span><span class="fu">sum</span>(unnorm.post))</span>
<span id="cb66-20"><a href="cross.html#cb66-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(theta,post,<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">main=</span><span class="st">&#39;Normalized posterior&#39;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span><span class="sc">*</span><span class="fu">max</span>(post)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<ul>
<li><ol start="2" style="list-style-type: lower-alpha">
<li>Sample 1000 draws from theta from posterior density and plot histogram
we sample from theta [0,100] using the grid approximation, and the probability is from the posterior distribution.</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="cross.html#cb67-1" aria-hidden="true" tabindex="-1"></a>  samps<span class="ot">&lt;-</span>(<span class="fu">sample</span>(theta,<span class="dv">1000</span>,<span class="at">prob=</span>post<span class="sc">*</span>step,<span class="at">replace=</span>T))</span>
<span id="cb67-2"><a href="cross.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(samps,<span class="at">main=</span><span class="fu">mean</span>(samps))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="cross.html#cb68-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">##sample mean is close to the mean of the observed.</span></span></code></pre></div>
<ul>
<li><ol start="3" style="list-style-type: lower-alpha">
<li>Using the previous 1000 samples of <span class="math inline">\(\theta\)</span> to obtain 1000 samples from the predictive distribution of a future observation <span class="math inline">\(y_6\)</span>, and plot the predictive draws.
we use the sampled thetas from the posterior to sample from the Cauchy distribution. The predictive probability follows <span class="math inline">\(p(x|y) =\int p(x|\theta)p(\theta|y)d\theta\)</span> where <span class="math inline">\(p(x|\theta)\)</span> follows from the Cauchy distribution, given original sequence of thetas. We have the posterior values for each theta (given the uniform grid of thetas) and take the product. then for each predictive value, we sum the total probability across all thetas to compute the predictive probability. The maximum predictive value probability 0.52 with probability of 0.29.</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="cross.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="do">## predictive distribution ? ?? </span></span>
<span id="cb69-2"><a href="cross.html#cb69-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># p(x | y) = int p(x|theta)*p(theta|y ) dtheta</span></span>
<span id="cb69-3"><a href="cross.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="do">## the posterior is p(theta|y) </span></span>
<span id="cb69-4"><a href="cross.html#cb69-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># the likelihood p(x|theta)  ## we use the sampled thetas using the posterior</span></span>
<span id="cb69-5"><a href="cross.html#cb69-5" aria-hidden="true" tabindex="-1"></a> ytilde<span class="ot">&lt;-</span><span class="fu">rcauchy</span>(<span class="dv">1000</span>,<span class="at">location=</span>samps,<span class="at">scale=</span><span class="dv">1</span>) </span>
<span id="cb69-6"><a href="cross.html#cb69-6" aria-hidden="true" tabindex="-1"></a> <span class="do">## probability of the samples </span></span>
<span id="cb69-7"><a href="cross.html#cb69-7" aria-hidden="true" tabindex="-1"></a> <span class="co">#prob_samp&lt;-post[match(samps,theta)]</span></span>
<span id="cb69-8"><a href="cross.html#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(ytilde) <span class="do">## we have a wide distribution of predictive values.</span></span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -227.566   -0.669    0.548    6.727    1.473 4337.310</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="cross.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="do">## for all predictive values,  find the total probability  </span></span>
<span id="cb71-2"><a href="cross.html#cb71-2" aria-hidden="true" tabindex="-1"></a>   <span class="do">## int p(x|theta)*p(theta|y) d\theta  note that p(x|theta) is a function of theta, so we input hte theta grid.</span></span>
<span id="cb71-3"><a href="cross.html#cb71-3" aria-hidden="true" tabindex="-1"></a> pred.prob<span class="ot">&lt;-</span><span class="fu">sapply</span>(ytilde,<span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">dcauchy</span>(x,<span class="at">location=</span>theta,<span class="at">scale=</span><span class="dv">1</span>)<span class="sc">*</span>post<span class="sc">*</span>step))  </span>
<span id="cb71-4"><a href="cross.html#cb71-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-5"><a href="cross.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(ytilde,pred.prob, <span class="at">main=</span><span class="st">&#39;predictive distribution&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="cross.html#cb72-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## maximum predictive probability</span></span>
<span id="cb72-2"><a href="cross.html#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&#39;max pred. prob &#39;</span>, <span class="fu">round</span>(ytilde[<span class="fu">which</span>(pred.prob<span class="sc">==</span><span class="fu">max</span>(pred.prob))],<span class="dv">3</span>))</span></code></pre></div>
<pre><code>## max pred. prob 0.518</code></pre>
</div>
<div id="question-12" class="section level3 unnumbered hasAnchor">
<h3>Question 12<a href="cross.html#question-12" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose <span class="math inline">\(y|\theta \sim Poisson(\theta)\)</span>, find Jeffreys’ prior density for <span class="math inline">\(\theta\)</span> and then find <span class="math inline">\(\alpha,\beta\)</span> for which Gamma(a,b) density is a close match to Jeffreys’ density.</p>
<p><span class="math display">\[
\begin{aligned}
log(p(y|\theta))&amp;= y*log(\theta)-\theta -log(y!)\\
&amp;\implies y&#39; = y/\theta - 1 ,  y&#39;&#39; = -y/\theta^2 \\
&amp;\implies J(\theta)= E(- l&#39;&#39;)= E(y/\theta^2)= 1/\theta \\
&amp;= p(\theta)\propto |J(\theta)^{1/2}| = \sqrt{1/\theta} = \theta^{-1/2}\\
\end{aligned}
\]</span>
So the closes prior is <span class="math inline">\(\alpha=1/2 , \beta=0\)</span>.</p>
</div>
<div id="question-13" class="section level3 unnumbered hasAnchor">
<h3>Question 13<a href="cross.html#question-13" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><ol style="list-style-type: lower-alpha">
<li>Use the normal approximation to gamma and poisson to determine a posterior for fatal accidents using table 2.2. Compute the 95<span class="math inline">\(\%\)</span> predictive interval.</li>
</ol></li>
<li><p>We set the empirical prior alpha =25 and beta =1 because the effective sample size (<span class="math inline">\(\beta\)</span>) is mean is approximately 25, and given these the quantiles of the prior distribution is 16.2 and 35.7 which contains the observed data well. and the prior mean is approximately 25 which is reasonably close to the table 2.2 values, although a sensitivity analysis is recommended.</p></li>
<li><p>We use the conjugate prior for Gamma to find the posterior distribution, which closely is approximated by the normal distribution. The posterior distributions are similar. The normal approximation prior followed <span class="math inline">\(N(\alpha/\beta, \sqrt{\alpha}/\beta)\)</span>. we set the variance to be known <span class="math inline">\(\sigma^2=100\)</span>. Using the gamma conjugate prior the predictive interval is $95% $ (21.1,26.9).</p></li>
<li><p>The posterior predictive value was determined by sample values from the posterior, and using the parameters sampled from posterior to generate a Poisson random variable. The average predictive value is 23.9 fatal accidents.</p></li>
</ul>
<p>-Using Jeffrey’s prior we set alpha=1/2 and beta=0.02 which has a prior mean of 25 which matches the observed mean. The posterior using Jeffreys’ prior credible interval 95<span class="math inline">\(\%\)</span> is (21.11, 26.88) which is similar to the empirical prior. Using the normal approximation to Jeffreys’ prior has a 95<span class="math inline">\(\%\)</span> predictive interval of (14,34) with a predictive mean of 23.83. The posterior predictive value for 1986 was computed by sampling <span class="math inline">\(\theta\)</span> from the posterior distribution, and for each <span class="math inline">\(\theta_j\)</span>, we sampled a random variable from Poisson(<span class="math inline">\(\lambda=\theta_j)\)</span>.</p>
<p>-Using Jeffreys’ prior, the posteror is <span class="math inline">\(p(\theta|y) \sim Gamma(238.5,10.2)\)</span>. Using simulation the <span class="math inline">\(95\%\)</span> predictive invterval is (14,34). Using the normal approximation
- Using the posterior predictiction equation <span class="math inline">\(E(x|y) = E(\theta| y) = \mu\)</span>. and the V(<span class="math inline">\(x|y)= E(\theta| y)+ V(\theta | y)\)</span>. Using the normal approximation <span class="math inline">\(\mu_n = 23.8\)</span> and <span class="math inline">\(\tau_n^2 = 9.9\)</span>. Then the posterior variance is 23.8+9.9 = 33.7. Then using <span class="math inline">\(\mu \pm 1.96\sigma_n = (12.43 35.19)\)</span>.
The true observed value for 1986 is 22 fatal accidents.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="cross.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data entry</span></span>
<span id="cb74-2"><a href="cross.html#cb74-2" aria-hidden="true" tabindex="-1"></a> year<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1976</span>,<span class="dv">1985</span>)</span>
<span id="cb74-3"><a href="cross.html#cb74-3" aria-hidden="true" tabindex="-1"></a> fatal<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">24</span>,<span class="dv">25</span>,<span class="dv">31</span>,<span class="dv">31</span>,<span class="dv">22</span>,<span class="dv">21</span>,<span class="dv">26</span>,<span class="dv">20</span>,<span class="dv">16</span>,<span class="dv">22</span>)</span>
<span id="cb74-4"><a href="cross.html#cb74-4" aria-hidden="true" tabindex="-1"></a> death<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">734</span>,<span class="dv">516</span>,<span class="dv">754</span>,<span class="dv">877</span>,<span class="dv">814</span>,<span class="dv">362</span>,<span class="dv">764</span>,<span class="dv">809</span>,<span class="dv">223</span>,<span class="dv">1066</span>)</span>
<span id="cb74-5"><a href="cross.html#cb74-5" aria-hidden="true" tabindex="-1"></a> rate<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">0.19</span>,<span class="fl">0.12</span>,<span class="fl">0.15</span>,<span class="fl">0.16</span>,<span class="fl">0.14</span>,<span class="fl">0.06</span>,<span class="fl">0.13</span>,<span class="fl">0.13</span>,<span class="fl">0.03</span>,<span class="fl">0.15</span>)</span>
<span id="cb74-6"><a href="cross.html#cb74-6" aria-hidden="true" tabindex="-1"></a> data<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">year=</span>year,<span class="at">fatal=</span>fatal,<span class="at">pass.deaths=</span>death,<span class="at">death.rate=</span>rate)</span>
<span id="cb74-7"><a href="cross.html#cb74-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb74-8"><a href="cross.html#cb74-8" aria-hidden="true" tabindex="-1"></a> <span class="do">## gamma prior on theta&gt;0</span></span>
<span id="cb74-9"><a href="cross.html#cb74-9" aria-hidden="true" tabindex="-1"></a> theta<span class="ot">=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>,<span class="at">to=</span><span class="dv">50</span>,<span class="at">by=</span>.<span class="dv">01</span>)</span>
<span id="cb74-10"><a href="cross.html#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="cross.html#cb74-11" aria-hidden="true" tabindex="-1"></a> <span class="do">## normal approximation to gamma</span></span>
<span id="cb74-12"><a href="cross.html#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Gamma(a,b) ,  mean = a/b,  var = a/b^2  ## where beta is the inverse-scale</span></span>
<span id="cb74-13"><a href="cross.html#cb74-13" aria-hidden="true" tabindex="-1"></a>   <span class="do">## gamma(a,b) ~  N (a/b, sd= sqrt(a)/b)</span></span>
<span id="cb74-14"><a href="cross.html#cb74-14" aria-hidden="true" tabindex="-1"></a> <span class="do">## normal approx to Pois</span></span>
<span id="cb74-15"><a href="cross.html#cb74-15" aria-hidden="true" tabindex="-1"></a>   <span class="do">## Pois(a) ,  mean =a, var= a</span></span>
<span id="cb74-16"><a href="cross.html#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Pois(a) ~ N(a,sd= sqrt(a))</span></span>
<span id="cb74-17"><a href="cross.html#cb74-17" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb74-18"><a href="cross.html#cb74-18" aria-hidden="true" tabindex="-1"></a> <span class="do">## gamma prior of total count a-1,  in b observations </span></span>
<span id="cb74-19"><a href="cross.html#cb74-19" aria-hidden="true" tabindex="-1"></a> <span class="do">## empirical prior</span></span>
<span id="cb74-20"><a href="cross.html#cb74-20" aria-hidden="true" tabindex="-1"></a> <span class="do">## we approximate a prior to have an average of 25 deaths across the decade.  the empirical mean is 23.8 ~ 24</span></span>
<span id="cb74-21"><a href="cross.html#cb74-21" aria-hidden="true" tabindex="-1"></a> <span class="co">#  the beta parameter is set rate is set such that gamma(25,1) has quantiles  16.2, 35.7 which matches well the observed data.</span></span>
<span id="cb74-22"><a href="cross.html#cb74-22" aria-hidden="true" tabindex="-1"></a>   alpha<span class="ot">=</span> <span class="dv">25</span></span>
<span id="cb74-23"><a href="cross.html#cb74-23" aria-hidden="true" tabindex="-1"></a>   beta<span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb74-24"><a href="cross.html#cb74-24" aria-hidden="true" tabindex="-1"></a>   <span class="do">## the mean rate given the data is 0.126, so we find the beta parameter to match the mean rate.</span></span>
<span id="cb74-25"><a href="cross.html#cb74-25" aria-hidden="true" tabindex="-1"></a>   n<span class="ot">&lt;-</span><span class="fu">nrow</span>(data)</span>
<span id="cb74-26"><a href="cross.html#cb74-26" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot;the prior interval:&quot;</span>,<span class="fu">qgamma</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>),alpha,beta))</span></code></pre></div>
<pre><code>## the prior interval:16.178681847829335.7100975937532</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="cross.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="do">## non-informative prior using Jeffrey&#39;s prior</span></span>
<span id="cb76-2"><a href="cross.html#cb76-2" aria-hidden="true" tabindex="-1"></a>  Jalpha<span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb76-3"><a href="cross.html#cb76-3" aria-hidden="true" tabindex="-1"></a>   Jbeta<span class="ot">&lt;-</span> <span class="fl">0.02</span> <span class="do">## we set close to 0</span></span>
<span id="cb76-4"><a href="cross.html#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="do">## prior mean is 25 which matches the observed data.</span></span>
<span id="cb76-5"><a href="cross.html#cb76-5" aria-hidden="true" tabindex="-1"></a>   <span class="do">## the mean rate given the data is 0.126, so we find the beta parameter to match the mean rate.</span></span>
<span id="cb76-6"><a href="cross.html#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;the prior interval:&quot;</span>)</span></code></pre></div>
<pre><code>## the prior interval:</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="cross.html#cb78-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">qgamma</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>),Jalpha,Jbeta))</span></code></pre></div>
<pre><code>## [1]   0.02455173 125.59715468</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="cross.html#cb80-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(theta,<span class="fu">dgamma</span>(theta,alpha,<span class="at">rate=</span>beta),<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb80-2"><a href="cross.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(theta,<span class="fu">dgamma</span>(theta,alpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(fatal),<span class="at">rate=</span>beta<span class="sc">+</span>n),<span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb80-3"><a href="cross.html#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(theta,<span class="fu">dgamma</span>(theta,Jalpha,<span class="at">rate=</span>Jbeta),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb80-4"><a href="cross.html#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(theta,<span class="fu">dgamma</span>(theta,Jalpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(fatal),<span class="at">rate=</span>Jbeta<span class="sc">+</span>n),<span class="at">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb80-5"><a href="cross.html#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">35</span>, <span class="fl">0.06</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Empr.Prior&quot;</span>, <span class="st">&quot;Posterior1&quot;</span>,<span class="st">&quot;Jeff.&quot;</span>,<span class="st">&quot;Posterior2&quot;</span>),</span>
<span id="cb80-6"><a href="cross.html#cb80-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>), <span class="at">lty=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="cross.html#cb81-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## credible interval of the posterior</span></span>
<span id="cb81-2"><a href="cross.html#cb81-2" aria-hidden="true" tabindex="-1"></a> pois_credible<span class="ot">&lt;-</span><span class="fu">qgamma</span>(<span class="fu">c</span>(.<span class="dv">025</span>,<span class="fl">0.975</span>),alpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(fatal),<span class="at">rate=</span>beta<span class="sc">+</span>n)</span>
<span id="cb81-3"><a href="cross.html#cb81-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot;posterior gamma interval n=10: &quot;</span>,pois_credible[<span class="dv">1</span>],<span class="st">&quot; &quot;</span>,pois_credible[<span class="dv">2</span>]) <span class="do">## </span></span></code></pre></div>
<pre><code>## posterior gamma interval n=10: 21.1065649790459 26.883779321636</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="cross.html#cb83-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## jeffrey&#39;s prior</span></span>
<span id="cb83-2"><a href="cross.html#cb83-2" aria-hidden="true" tabindex="-1"></a>  pois_credible_jp<span class="ot">&lt;-</span><span class="fu">qgamma</span>(<span class="fu">c</span>(.<span class="dv">025</span>,<span class="fl">0.975</span>),Jalpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(fatal),<span class="at">rate=</span>Jbeta<span class="sc">+</span>n)</span>
<span id="cb83-3"><a href="cross.html#cb83-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot;posterior gamma interval n=10: &quot;</span>,pois_credible[<span class="dv">1</span>],<span class="st">&quot; &quot;</span>,pois_credible[<span class="dv">2</span>]) <span class="do">## </span></span></code></pre></div>
<pre><code>## posterior gamma interval n=10: 21.1065649790459 26.883779321636</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="cross.html#cb85-1" aria-hidden="true" tabindex="-1"></a> post_pois<span class="ot">&lt;-</span><span class="fu">dgamma</span>(theta,Jalpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(fatal),<span class="at">rate=</span>Jbeta<span class="sc">+</span>n)</span>
<span id="cb85-2"><a href="cross.html#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## posterior mean is 23.8</span></span>
<span id="cb85-3"><a href="cross.html#cb85-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">sum</span>(theta<span class="sc">*</span>post_pois<span class="sc">/</span><span class="fu">sum</span>(post_pois))</span></code></pre></div>
<pre><code>## [1] 23.8024</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="cross.html#cb87-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># normal approximation using Jeffrey&#39;s Prior</span></span>
<span id="cb87-2"><a href="cross.html#cb87-2" aria-hidden="true" tabindex="-1"></a>  mu_0<span class="ot">&lt;-</span> Jalpha<span class="sc">/</span>Jbeta  <span class="do">## average of 12.6 fatal accidents</span></span>
<span id="cb87-3"><a href="cross.html#cb87-3" aria-hidden="true" tabindex="-1"></a>  tau2_0<span class="ot">&lt;-</span> Jalpha<span class="sc">/</span>Jbeta<span class="sc">^</span><span class="dv">2</span> <span class="do">## </span></span>
<span id="cb87-4"><a href="cross.html#cb87-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-5"><a href="cross.html#cb87-5" aria-hidden="true" tabindex="-1"></a>  sigma2<span class="ot">&lt;-</span><span class="dv">10</span><span class="sc">^</span><span class="dv">2</span>  <span class="do">## we assume we know the variance of the fatalities (empirical variance is 22.2) so we set it to 50 (large enough)</span></span>
<span id="cb87-6"><a href="cross.html#cb87-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-7"><a href="cross.html#cb87-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-8"><a href="cross.html#cb87-8" aria-hidden="true" tabindex="-1"></a>  mu_n<span class="ot">&lt;-</span><span class="cf">function</span>(mu0,ybar,n,tau02,sigma2){</span>
<span id="cb87-9"><a href="cross.html#cb87-9" aria-hidden="true" tabindex="-1"></a>  mun<span class="ot">&lt;-</span> (mu0<span class="sc">/</span>tau02 <span class="sc">+</span> (ybar<span class="sc">*</span>n)<span class="sc">/</span>sigma2)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span>tau02 <span class="sc">+</span> n<span class="sc">/</span>sigma2)</span>
<span id="cb87-10"><a href="cross.html#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mun)</span>
<span id="cb87-11"><a href="cross.html#cb87-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-12"><a href="cross.html#cb87-12" aria-hidden="true" tabindex="-1"></a>taun2<span class="ot">&lt;-</span><span class="cf">function</span>(tau02,n,sigma2){</span>
<span id="cb87-13"><a href="cross.html#cb87-13" aria-hidden="true" tabindex="-1"></a>  inv.taun2<span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>tau02 <span class="sc">+</span>n<span class="sc">/</span>sigma2</span>
<span id="cb87-14"><a href="cross.html#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">1</span><span class="sc">/</span>inv.taun2)</span>
<span id="cb87-15"><a href="cross.html#cb87-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-16"><a href="cross.html#cb87-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-17"><a href="cross.html#cb87-17" aria-hidden="true" tabindex="-1"></a>ybar<span class="ot">=</span><span class="fu">mean</span>(fatal)</span>
<span id="cb87-18"><a href="cross.html#cb87-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-19"><a href="cross.html#cb87-19" aria-hidden="true" tabindex="-1"></a> mn<span class="ot">&lt;-</span><span class="fu">mu_n</span>(mu_0,ybar,tau2_0,n,sigma2)</span>
<span id="cb87-20"><a href="cross.html#cb87-20" aria-hidden="true" tabindex="-1"></a> tn<span class="ot">&lt;-</span><span class="fu">taun2</span>(tau2_0,n,sigma2)</span>
<span id="cb87-21"><a href="cross.html#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="do">## posterior interval n=10</span></span>
<span id="cb87-22"><a href="cross.html#cb87-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lower&lt;-round(qnorm(0.025,mu_n(mu0,ybar,tau02,10,sigma2),sd=sqrt(taun2(tau02,10,sigma2))),2)</span></span>
<span id="cb87-23"><a href="cross.html#cb87-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">c</span>(mn<span class="fl">-1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(mn<span class="sc">+</span>tn), mn<span class="fl">+1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(mn<span class="sc">+</span>tn)))</span></code></pre></div>
<pre><code>## [1] 12.42630 35.19275</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="cross.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="do">## posterior predictive value</span></span>
<span id="cb89-2"><a href="cross.html#cb89-2" aria-hidden="true" tabindex="-1"></a>   <span class="do">## check this with the grid approach in the Gamma framework.  </span></span>
<span id="cb89-3"><a href="cross.html#cb89-3" aria-hidden="true" tabindex="-1"></a>  theta_samps<span class="ot">&lt;-</span><span class="fu">sample</span>(theta,<span class="dv">10000</span>,<span class="at">prob=</span>post_pois,<span class="at">replace=</span>T)</span>
<span id="cb89-4"><a href="cross.html#cb89-4" aria-hidden="true" tabindex="-1"></a>   ytilde<span class="ot">&lt;-</span><span class="fu">rpois</span>(<span class="dv">10000</span>,<span class="at">lambda=</span>theta_samps) </span>
<span id="cb89-5"><a href="cross.html#cb89-5" aria-hidden="true" tabindex="-1"></a> <span class="do">## probability of the samples </span></span>
<span id="cb89-6"><a href="cross.html#cb89-6" aria-hidden="true" tabindex="-1"></a> <span class="co">#prob_samp&lt;-post[match(samps,theta)]</span></span>
<span id="cb89-7"><a href="cross.html#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(ytilde) <span class="do">## we have a wide distribution of predictive values.</span></span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    8.00   20.00   24.00   23.79   27.00   45.00</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="cross.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="do">## for all predictive values,  find the total probability  </span></span>
<span id="cb91-2"><a href="cross.html#cb91-2" aria-hidden="true" tabindex="-1"></a>   <span class="do">## int p(x|theta)*p(theta|y) d\theta  note that p(x|theta) is a function of theta, so we input hte theta grid.</span></span>
<span id="cb91-3"><a href="cross.html#cb91-3" aria-hidden="true" tabindex="-1"></a> pred.prob<span class="ot">&lt;-</span><span class="fu">sapply</span>(ytilde,<span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">dpois</span>(x,<span class="at">lambda =</span> theta)<span class="sc">*</span>post_pois<span class="sc">/</span><span class="fu">sum</span>(post_pois)))  </span>
<span id="cb91-4"><a href="cross.html#cb91-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-5"><a href="cross.html#cb91-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(ytilde,pred.prob, <span class="at">main=</span><span class="st">&#39;predictive distribution for future 1986&#39;</span>)</span>
<span id="cb91-6"><a href="cross.html#cb91-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">abline</span>(<span class="at">v=</span><span class="fu">quantile</span>(ytilde,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-2.png" width="672" /></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="cross.html#cb92-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#lines(theta,post_pois)</span></span>
<span id="cb92-2"><a href="cross.html#cb92-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">quantile</span>(ytilde,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##  2.5% 97.5% 
##    14    34</code></pre>
<p>From the gamma posterior <span class="math inline">\(E(\theta | y) = 238.5/10.02=24.25\)</span> and the variance <span class="math inline">\(V(\theta|y)= 238.5/10.02^2=2.87\)</span>. From the Poisson likelihood <span class="math inline">\(E(x|\theta)=\theta\)</span> and <span class="math inline">\(V(x|\theta)=\theta\)</span>. <span class="math inline">\(V(x|y)= E(V(x|\theta,y) | y) + V(E(x|\theta,y)|y)= E(\theta| y)+ V(\theta|y) = 23.382+2.87= 26.252\)</span></p>
<p>Using the normal approximation on the posterior values, the variance of the predictive value and is a larger interval (14.21, 34.3).</p>
<p>The average predictive value from 1986 is 24.3 which is close to the true value 22 fatal accidents.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="cross.html#cb94-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Predictive with normal</span></span>
<span id="cb94-2"><a href="cross.html#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="cross.html#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="do">## using the normal approximation</span></span>
<span id="cb94-4"><a href="cross.html#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="do">## predictive interval must use a grid approach.</span></span>
<span id="cb94-5"><a href="cross.html#cb94-5" aria-hidden="true" tabindex="-1"></a>     pred<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>),<span class="fl">24.25</span>,<span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fl">26.252</span>)),<span class="dv">2</span>)</span>
<span id="cb94-6"><a href="cross.html#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;predictive interval n=10: &quot;</span>,pred[<span class="dv">1</span>],<span class="st">&quot; &quot;</span>,pred[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## predictive interval n=10: 14.21 34.29</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="cross.html#cb96-1" aria-hidden="true" tabindex="-1"></a>   <span class="do">## check this with the grid approach in the normal framework.  </span></span>
<span id="cb96-2"><a href="cross.html#cb96-2" aria-hidden="true" tabindex="-1"></a>  post_pred_norm<span class="ot">&lt;-</span>(<span class="fu">dnorm</span>(theta,<span class="fl">24.25</span>,<span class="fu">sqrt</span>(<span class="fl">26.252</span>))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">dnorm</span>(theta,<span class="fl">24.25</span>,<span class="fu">sqrt</span>(<span class="fl">26.252</span>))))</span>
<span id="cb96-3"><a href="cross.html#cb96-3" aria-hidden="true" tabindex="-1"></a>   ytilde_norm<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">100000</span>,<span class="at">mean=</span><span class="fl">24.25</span>,<span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fl">26.252</span>)) </span>
<span id="cb96-4"><a href="cross.html#cb96-4" aria-hidden="true" tabindex="-1"></a> <span class="do">## probability of the samples </span></span>
<span id="cb96-5"><a href="cross.html#cb96-5" aria-hidden="true" tabindex="-1"></a> <span class="co">#prob_samp&lt;-post[match(samps,theta)]</span></span>
<span id="cb96-6"><a href="cross.html#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(ytilde_norm) <span class="do">## we have a wide distribution of predictive values.</span></span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.89   20.80   24.26   24.24   27.70   47.28</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="cross.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="do">## for all predictive values,  find the total probability  </span></span>
<span id="cb98-2"><a href="cross.html#cb98-2" aria-hidden="true" tabindex="-1"></a>   <span class="do">## int p(x|theta)*p(theta|y) d\theta  note that p(x|theta) is a function of theta, so we input hte theta grid.</span></span>
<span id="cb98-3"><a href="cross.html#cb98-3" aria-hidden="true" tabindex="-1"></a> pred.prob_norm<span class="ot">&lt;-</span><span class="fu">sapply</span>(ytilde_norm,<span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">dnorm</span>(x,<span class="fl">24.25</span>,<span class="fu">sqrt</span>(<span class="fl">26.252</span>))<span class="sc">*</span>post_pred_norm))  </span>
<span id="cb98-4"><a href="cross.html#cb98-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-5"><a href="cross.html#cb98-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(ytilde_norm,pred.prob_norm, <span class="at">main=</span><span class="st">&#39;predictive distribution for future 1986&#39;</span>)</span>
<span id="cb98-6"><a href="cross.html#cb98-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">abline</span>(<span class="at">v=</span><span class="fu">quantile</span>(ytilde_norm,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb98-7"><a href="cross.html#cb98-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">lines</span>(theta,post_pred_norm)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="cross.html#cb99-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">quantile</span>(ytilde_norm,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##     2.5%    97.5% 
## 14.15578 34.29642</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="cross.html#cb101-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot;average predictive value from posterior:&quot;</span>, <span class="fu">mean</span>(ytilde))</span></code></pre></div>
<pre><code>## average predictive value from posterior:23.7866</code></pre>
<ul>
<li><ol start="2" style="list-style-type: lower-alpha">
<li>Assume fatal accidents follow a Poisson distribution with a constant rate and an exposure in each year proportional to the number of passanger miles flown. Set a prior and determine a posterior and predictive distribution. estimate the number of passanger miles flown in each year by dividing</li>
</ol></li>
</ul>
<p>let <span class="math inline">\(\theta\)</span> be the fatal accidents <em>rate</em> per 100,000 million miles flown. and let <span class="math inline">\(x_i\)</span> be the number per 100,000 million miles flown. We compute the miles by dividing the passenger deaths divided by the death rate (deaths per 100,000 million miles flown).</p>
<p>We then compute the fatal accident rate by computing the (passanger deaths per 100,000 million miles)*(number of fatal accidents / number of passenger deaths). We let <span class="math inline">\(\theta\)</span> = fatal accidents per 100 million miles flown.</p>
<p>The mean accident rate is 0.004, so we set alpha =5 and beta = 1000, so the prior mean is 0.005 (95<span class="math inline">\(\%\)</span>: 0.002,0.01) which is similar to the observed ranges. This is using the observed data to create an empirically driven prior.</p>
<p>However, we must use the Jeffreys’ prior for a non-informative prior setting <span class="math inline">\(\alpha=0.01, \beta=0.01\)</span>.</p>
<p>Using Jeffreys’ prior, the posterior is Gamma(238.01, 5.716e12) with a 95 credible interval of (3.65e-11, 4.71e-11).</p>
<p>Now for the posterior predictive value, because the parameters space is so small, we sample <span class="math inline">\(\theta\)</span> from <span class="math inline">\(p(\theta | y)\)</span> Gamma posterior to generate <span class="math inline">\(\theta\)</span>. In the previous exercise, we used theta from a uniform sequence, but these values are so small due to the scaling it is easier to sample directly from the posterior using <code>rgamma</code>. THen we find the predictive value <span class="math inline">\(x \sim Pois(8e11*\theta_j)\)</span> by random sampling observation variables from the posterior, and sorting them for the 95 predictive interval.</p>
<p>We can also use the normal approximation, but the equations for the mean and variance must be scaled by the factor 8e11.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="cross.html#cb103-1" aria-hidden="true" tabindex="-1"></a> miles100<span class="ot">&lt;-</span>death<span class="sc">/</span>rate <span class="do">## 100 million miles</span></span>
<span id="cb103-2"><a href="cross.html#cb103-2" aria-hidden="true" tabindex="-1"></a>miles <span class="ot">=</span> miles100<span class="sc">*</span><span class="fl">1e+08</span></span>
<span id="cb103-3"><a href="cross.html#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="cross.html#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="cross.html#cb103-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-6"><a href="cross.html#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="do">## likelihood   </span></span>
<span id="cb103-7"><a href="cross.html#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="do">## y | miles, theta ~ Pois( miles*theta)</span></span>
<span id="cb103-8"><a href="cross.html#cb103-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-9"><a href="cross.html#cb103-9" aria-hidden="true" tabindex="-1"></a> theta<span class="ot">=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>,<span class="at">to=</span><span class="fl">0.1</span>,<span class="at">by=</span>.<span class="dv">001</span>)</span>
<span id="cb103-10"><a href="cross.html#cb103-10" aria-hidden="true" tabindex="-1"></a> <span class="do">## empirical prior</span></span>
<span id="cb103-11"><a href="cross.html#cb103-11" aria-hidden="true" tabindex="-1"></a>  alpha<span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb103-12"><a href="cross.html#cb103-12" aria-hidden="true" tabindex="-1"></a>   beta<span class="ot">&lt;-</span> <span class="dv">1000</span>  </span>
<span id="cb103-13"><a href="cross.html#cb103-13" aria-hidden="true" tabindex="-1"></a>   <span class="do">## the mean is 0.005 and quantiles 0.002 and 0.01 which is close to the observed rates </span></span>
<span id="cb103-14"><a href="cross.html#cb103-14" aria-hidden="true" tabindex="-1"></a>   <span class="co">#mean(acc_rate) ## fatal accidents per 100,000 million miles driven</span></span>
<span id="cb103-15"><a href="cross.html#cb103-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="st">&quot;empirical prior 95% quantiles: &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;empirical prior 95% quantiles: &quot;</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="cross.html#cb105-1" aria-hidden="true" tabindex="-1"></a>   <span class="fu">qgamma</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>),alpha,<span class="at">rate=</span>beta)</span></code></pre></div>
<pre><code>## [1] 0.001623486 0.010241589</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="cross.html#cb107-1" aria-hidden="true" tabindex="-1"></a>   <span class="do">## the mean rate given the data is 0.126, so we find the beta parameter to match the mean rate.</span></span>
<span id="cb107-2"><a href="cross.html#cb107-2" aria-hidden="true" tabindex="-1"></a>   n<span class="ot">&lt;-</span><span class="fu">nrow</span>(data)</span>
<span id="cb107-3"><a href="cross.html#cb107-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb107-4"><a href="cross.html#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="do">## we must use Jeffreys&#39; prior!!     </span></span>
<span id="cb107-5"><a href="cross.html#cb107-5" aria-hidden="true" tabindex="-1"></a>  Jalpha<span class="ot">=</span><span class="fl">0.01</span></span>
<span id="cb107-6"><a href="cross.html#cb107-6" aria-hidden="true" tabindex="-1"></a>  Jbeta<span class="ot">&lt;-</span><span class="fl">0.01</span></span>
<span id="cb107-7"><a href="cross.html#cb107-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(theta,<span class="fu">dgamma</span>(theta,Jalpha,<span class="at">rate=</span>Jbeta),<span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb107-8"><a href="cross.html#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(theta,<span class="fu">dgamma</span>(theta,Jalpha<span class="sc">+</span><span class="fu">sum</span>(fatal),<span class="at">rate=</span>Jbeta<span class="sc">+</span><span class="fu">sum</span>(miles)),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="cross.html#cb108-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## credible interval of the posterior</span></span>
<span id="cb108-2"><a href="cross.html#cb108-2" aria-hidden="true" tabindex="-1"></a> pois_credible<span class="ot">&lt;-</span><span class="fu">qgamma</span>(<span class="fu">c</span>(.<span class="dv">025</span>,<span class="fl">0.975</span>),Jalpha<span class="sc">+</span><span class="fu">sum</span>(fatal),<span class="at">rate=</span>Jbeta<span class="sc">+</span><span class="fu">sum</span>(miles))</span>
<span id="cb108-3"><a href="cross.html#cb108-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot;Jeffreys&#39; prior posterior gamma interval n=10: &quot;</span>)</span></code></pre></div>
<pre><code>## Jeffreys&#39; prior posterior gamma interval n=10:</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="cross.html#cb110-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(pois_credible) <span class="do">## </span></span></code></pre></div>
<pre><code>## [1] 3.651772e-11 4.709401e-11</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="cross.html#cb112-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## generate parameters from the posterior we sample thetas.</span></span>
<span id="cb112-2"><a href="cross.html#cb112-2" aria-hidden="true" tabindex="-1"></a>  theta_post<span class="ot">&lt;-</span><span class="fu">rgamma</span>(<span class="dv">1000</span>,Jalpha<span class="sc">+</span><span class="fu">sum</span>(fatal),<span class="at">rate=</span>Jbeta<span class="sc">+</span><span class="fu">sum</span>(miles))</span>
<span id="cb112-3"><a href="cross.html#cb112-3" aria-hidden="true" tabindex="-1"></a>  y1986<span class="ot">&lt;-</span><span class="fu">rpois</span>(<span class="dv">1000</span>,<span class="fl">8e+11</span><span class="sc">*</span>theta_post) <span class="do">## use in the likelihood</span></span>
<span id="cb112-4"><a href="cross.html#cb112-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># message(&quot; predictive 1986 interval: &quot;)</span></span>
<span id="cb112-5"><a href="cross.html#cb112-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># sort(y1986)[c(25,976)]</span></span>
<span id="cb112-6"><a href="cross.html#cb112-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-7"><a href="cross.html#cb112-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-8"><a href="cross.html#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="do">### the original sequenced theta do not produce parameters from the posterior and this fails.  </span></span>
<span id="cb112-9"><a href="cross.html#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># post_pois&lt;-dgamma(theta,Jalpha+sum(fatal),rate=Jbeta+sum(miles))</span></span>
<span id="cb112-10"><a href="cross.html#cb112-10" aria-hidden="true" tabindex="-1"></a> <span class="co"># theta_samps&lt;-sample(theta,100000,prob=post_pois,replace=T)</span></span>
<span id="cb112-11"><a href="cross.html#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ytilde&lt;-rpois(100000,lambda=8e+11*theta_samps) </span></span>
<span id="cb112-12"><a href="cross.html#cb112-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-13"><a href="cross.html#cb112-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-14"><a href="cross.html#cb112-14" aria-hidden="true" tabindex="-1"></a>  post_a<span class="ot">=</span> Jalpha<span class="sc">+</span><span class="fu">sum</span>(fatal)</span>
<span id="cb112-15"><a href="cross.html#cb112-15" aria-hidden="true" tabindex="-1"></a>  post_b<span class="ot">=</span> Jbeta<span class="sc">+</span><span class="fu">sum</span>(miles)</span>
<span id="cb112-16"><a href="cross.html#cb112-16" aria-hidden="true" tabindex="-1"></a>   <span class="do">## use the normal approximation</span></span>
<span id="cb112-17"><a href="cross.html#cb112-17" aria-hidden="true" tabindex="-1"></a>   <span class="do">## E = a/b  V = a/b^2</span></span>
<span id="cb112-18"><a href="cross.html#cb112-18" aria-hidden="true" tabindex="-1"></a>   mn_a <span class="ot">=</span> post_a<span class="sc">/</span>post_b</span>
<span id="cb112-19"><a href="cross.html#cb112-19" aria-hidden="true" tabindex="-1"></a>   tn_a <span class="ot">=</span> post_a<span class="sc">/</span>post_b<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb112-20"><a href="cross.html#cb112-20" aria-hidden="true" tabindex="-1"></a>   <span class="do">## xi*E(\theta | y) = xi*mu_1</span></span>
<span id="cb112-21"><a href="cross.html#cb112-21" aria-hidden="true" tabindex="-1"></a>   mu_approx <span class="ot">=</span> mn_a<span class="sc">*</span><span class="fl">8e+11</span></span>
<span id="cb112-22"><a href="cross.html#cb112-22" aria-hidden="true" tabindex="-1"></a>   <span class="do">## V(x|y) = xi*E(\theta|y) + xi^2*V(\theta|y) using the poisson likelihood and xi is the constant.</span></span>
<span id="cb112-23"><a href="cross.html#cb112-23" aria-hidden="true" tabindex="-1"></a>   sigma2_approx<span class="ot">&lt;-</span>mn_a<span class="sc">*</span><span class="fl">8e+11</span><span class="sc">+</span>(<span class="fl">8e+11</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>tn_a</span>
<span id="cb112-24"><a href="cross.html#cb112-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-25"><a href="cross.html#cb112-25" aria-hidden="true" tabindex="-1"></a>   <span class="do">## normal approxim</span></span>
<span id="cb112-26"><a href="cross.html#cb112-26" aria-hidden="true" tabindex="-1"></a> upper<span class="ot">&lt;-</span> mu_approx<span class="fl">+1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(sigma2_approx) <span class="do">## 46</span></span>
<span id="cb112-27"><a href="cross.html#cb112-27" aria-hidden="true" tabindex="-1"></a> lower<span class="ot">&lt;-</span> mu_approx<span class="fl">-1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(sigma2_approx) <span class="do">## 22</span></span>
<span id="cb112-28"><a href="cross.html#cb112-28" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot;normal approx: 95% pred. interval &quot;</span>)</span></code></pre></div>
<pre><code>## normal approx: 95% pred. interval</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="cross.html#cb114-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">c</span>(lower,upper))</span></code></pre></div>
<pre><code>## [1] 21.23396 45.39038</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="cross.html#cb116-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot; 8,000 per 100 million miles flown has fatality rate: Gamma posterior&quot;</span>)</span></code></pre></div>
<pre><code>##  8,000 per 100 million miles flown has fatality rate: Gamma posterior</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="cross.html#cb118-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">sort</span>(y1986)[<span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">976</span>)])</span></code></pre></div>
<pre><code>## [1] 22 46</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="cross.html#cb120-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot; 8,000 per 100 million miles flown has fatality rate: normal approx&quot;</span>)</span></code></pre></div>
<pre><code>##  8,000 per 100 million miles flown has fatality rate: normal approx</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="cross.html#cb122-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">c</span>(lower,upper))</span></code></pre></div>
<pre><code>## [1] 21.23396 45.39038</code></pre>
<ul>
<li><ol start="3" style="list-style-type: lower-alpha">
<li>we repeat part (a) but for passenger deaths. we need to find a prior and determine the posterior distribution with a predictive interval.</li>
</ol></li>
</ul>
<p>We used an empirically derived prior, which does not match the solution, and so we include Jeffreys’ prior setting <span class="math inline">\(\alpha=1/2, \beta=0.01\)</span>.</p>
<p>Note that the death rate mean is not equal to the variance so the performance is not as good compared to the fatal accidents.</p>
<p>The 1986 prediction mean is 692 <span class="math inline">\(95\%\)</span> (638, 750) using the empirical derived priors estimated from the data.<br />
If we use Jeffreys’ prior the prediction interval is (638,741.05).</p>
<p>which is not the expected prediction of 546 passenger deaths. This is likely because Poisson is not a good fit because it is constrained.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="cross.html#cb124-1" aria-hidden="true" tabindex="-1"></a> theta<span class="ot">=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">200</span>,<span class="at">to=</span><span class="dv">1500</span>,<span class="at">by=</span>.<span class="dv">1</span>)</span>
<span id="cb124-2"><a href="cross.html#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="cross.html#cb124-3" aria-hidden="true" tabindex="-1"></a> <span class="do">## normal approximation to gamma</span></span>
<span id="cb124-4"><a href="cross.html#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Gamma(a,b) ,  mean = a/b,  var = a/b^2  ## where beta is the inverse-scale</span></span>
<span id="cb124-5"><a href="cross.html#cb124-5" aria-hidden="true" tabindex="-1"></a>   <span class="do">## gamma(a,b) ~  N (a/b, sd= sqrt(a)/b)</span></span>
<span id="cb124-6"><a href="cross.html#cb124-6" aria-hidden="true" tabindex="-1"></a> <span class="do">## normal approx to Pois</span></span>
<span id="cb124-7"><a href="cross.html#cb124-7" aria-hidden="true" tabindex="-1"></a>   <span class="do">## Pois(a) ,  mean =a, var= a</span></span>
<span id="cb124-8"><a href="cross.html#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Pois(a) ~ N(a,sd= sqrt(a))</span></span>
<span id="cb124-9"><a href="cross.html#cb124-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb124-10"><a href="cross.html#cb124-10" aria-hidden="true" tabindex="-1"></a> <span class="do">## gamma prior of total count a-1,  in b observations </span></span>
<span id="cb124-11"><a href="cross.html#cb124-11" aria-hidden="true" tabindex="-1"></a> <span class="do">## </span></span>
<span id="cb124-12"><a href="cross.html#cb124-12" aria-hidden="true" tabindex="-1"></a> <span class="do">## we approximate a prior to have an average of 600 passenger deaths across the decade.  </span></span>
<span id="cb124-13"><a href="cross.html#cb124-13" aria-hidden="true" tabindex="-1"></a><span class="co">#the empirical mean is 691 and variance is  63700.32</span></span>
<span id="cb124-14"><a href="cross.html#cb124-14" aria-hidden="true" tabindex="-1"></a><span class="co"># a/b =  691  and a/b^2 = 63700.32,  we solve for a and b</span></span>
<span id="cb124-15"><a href="cross.html#cb124-15" aria-hidden="true" tabindex="-1"></a> <span class="co">#  the beta parameter is set rate is set such that   404, 832 which matches well the observed data.</span></span>
<span id="cb124-16"><a href="cross.html#cb124-16" aria-hidden="true" tabindex="-1"></a>   alpha<span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb124-17"><a href="cross.html#cb124-17" aria-hidden="true" tabindex="-1"></a>   beta<span class="ot">&lt;-</span> <span class="fl">0.0108618</span></span>
<span id="cb124-18"><a href="cross.html#cb124-18" aria-hidden="true" tabindex="-1"></a>   <span class="do">## the pr</span></span>
<span id="cb124-19"><a href="cross.html#cb124-19" aria-hidden="true" tabindex="-1"></a>   n<span class="ot">&lt;-</span><span class="fu">nrow</span>(data)</span>
<span id="cb124-20"><a href="cross.html#cb124-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot;empricial prior: &quot;</span>)</span></code></pre></div>
<pre><code>## empricial prior:</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="cross.html#cb126-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">qgamma</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.795</span>),alpha,beta))</span></code></pre></div>
<pre><code>## [1] 317.9797 936.6278</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="cross.html#cb128-1" aria-hidden="true" tabindex="-1"></a>  Jalpha<span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb128-2"><a href="cross.html#cb128-2" aria-hidden="true" tabindex="-1"></a>   Jbeta<span class="ot">&lt;-</span> <span class="fl">0.02</span> </span>
<span id="cb128-3"><a href="cross.html#cb128-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb128-4"><a href="cross.html#cb128-4" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb128-5"><a href="cross.html#cb128-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(theta,<span class="fu">dgamma</span>(theta,alpha,<span class="at">rate=</span>beta),<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb128-6"><a href="cross.html#cb128-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">lines</span>(theta,<span class="fu">dgamma</span>(theta,Jalpha,<span class="at">rate=</span>Jbeta),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb128-7"><a href="cross.html#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(theta,<span class="fu">dgamma</span>(theta,alpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(death),<span class="at">rate=</span>beta<span class="sc">+</span>n),<span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="cross.html#cb129-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## credible interval of the posterior</span></span>
<span id="cb129-2"><a href="cross.html#cb129-2" aria-hidden="true" tabindex="-1"></a> pois_credible<span class="ot">&lt;-</span><span class="fu">qgamma</span>(<span class="fu">c</span>(.<span class="dv">025</span>,<span class="fl">0.975</span>),alpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(death),<span class="at">rate=</span>beta<span class="sc">+</span>n)</span>
<span id="cb129-3"><a href="cross.html#cb129-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot;posterior for empirical gamma interval n=10: &quot;</span>,<span class="fu">round</span>(pois_credible[<span class="dv">1</span>],<span class="dv">2</span>),<span class="st">&quot; &quot;</span>,<span class="fu">round</span>(pois_credible[<span class="dv">2</span>],<span class="dv">3</span>)) <span class="do">## </span></span></code></pre></div>
<pre><code>## posterior for empirical gamma interval n=10: 675.75 708.338</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="cross.html#cb131-1" aria-hidden="true" tabindex="-1"></a> jp_pois_credible<span class="ot">&lt;-</span><span class="fu">qgamma</span>(<span class="fu">c</span>(.<span class="dv">025</span>,<span class="fl">0.975</span>),Jalpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(death),<span class="at">rate=</span>Jbeta<span class="sc">+</span>n)</span>
<span id="cb131-2"><a href="cross.html#cb131-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot;posterior for Jeffreys&#39; gamma interval n=10: &quot;</span>,<span class="fu">round</span>(jp_pois_credible[<span class="dv">1</span>],<span class="dv">2</span>),<span class="st">&quot; &quot;</span>,<span class="fu">round</span>(jp_pois_credible[<span class="dv">2</span>],<span class="dv">3</span>)) <span class="do">## </span></span></code></pre></div>
<pre><code>## posterior for Jeffreys&#39; gamma interval n=10: 674.39 706.934</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="cross.html#cb133-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## produces too small probabilities from Jeffrey&#39;s and we can sample here</span></span>
<span id="cb133-2"><a href="cross.html#cb133-2" aria-hidden="true" tabindex="-1"></a> post_pois<span class="ot">&lt;-</span><span class="fu">dgamma</span>(theta,alpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(death),<span class="at">rate=</span>beta<span class="sc">+</span>n) <span class="do">## prob</span></span>
<span id="cb133-3"><a href="cross.html#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  prediction:  with the grid approach in the Gamma framework does not work for small valued thetas.</span></span>
<span id="cb133-4"><a href="cross.html#cb133-4" aria-hidden="true" tabindex="-1"></a> theta_samps<span class="ot">&lt;-</span><span class="fu">sample</span>(theta,<span class="dv">1000</span>,<span class="at">prob=</span>post_pois,<span class="at">replace=</span>T)</span>
<span id="cb133-5"><a href="cross.html#cb133-5" aria-hidden="true" tabindex="-1"></a>  ytilde_empiricalPrior<span class="ot">&lt;-</span><span class="fu">rpois</span>(<span class="dv">1000</span>,<span class="at">lambda=</span>theta_samps)</span>
<span id="cb133-6"><a href="cross.html#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;using the empirical prior, predictive posterior interval&quot;</span>)</span></code></pre></div>
<pre><code>## using the empirical prior, predictive posterior interval</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="cross.html#cb135-1" aria-hidden="true" tabindex="-1"></a>   <span class="fu">quantile</span>(ytilde_empiricalPrior,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##    2.5%   97.5% 
## 636.975 745.025</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="cross.html#cb137-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## direct sampling from posterior.</span></span>
<span id="cb137-2"><a href="cross.html#cb137-2" aria-hidden="true" tabindex="-1"></a> theta_post<span class="ot">&lt;-</span><span class="fu">rgamma</span>(<span class="dv">1000</span>,Jalpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(death),<span class="at">rate=</span>Jbeta<span class="sc">+</span>n)</span>
<span id="cb137-3"><a href="cross.html#cb137-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb137-4"><a href="cross.html#cb137-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb137-5"><a href="cross.html#cb137-5" aria-hidden="true" tabindex="-1"></a>   ytilde<span class="ot">&lt;-</span><span class="fu">rpois</span>(<span class="dv">1000</span>,<span class="at">lambda=</span>theta_post) </span>
<span id="cb137-6"><a href="cross.html#cb137-6" aria-hidden="true" tabindex="-1"></a> <span class="do">## probability of the samples </span></span>
<span id="cb137-7"><a href="cross.html#cb137-7" aria-hidden="true" tabindex="-1"></a> <span class="co">#prob_samp&lt;-post[match(samps,theta)]</span></span>
<span id="cb137-8"><a href="cross.html#cb137-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(ytilde) <span class="do">## we have a wide distribution of predictive values.</span></span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   598.0   674.0   692.0   692.4   710.2   806.0</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="cross.html#cb139-1" aria-hidden="true" tabindex="-1"></a>   post_pois<span class="ot">&lt;-</span><span class="fu">dgamma</span>(theta_post,Jalpha<span class="sc">+</span>n<span class="sc">*</span><span class="fu">mean</span>(death),<span class="at">rate=</span>Jbeta<span class="sc">+</span>n)</span>
<span id="cb139-2"><a href="cross.html#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="cross.html#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="do">## for all predictive values,  find the total probability  </span></span>
<span id="cb139-4"><a href="cross.html#cb139-4" aria-hidden="true" tabindex="-1"></a>   <span class="do">## int p(x|theta)*p(theta|y) d\theta  note that p(x|theta) is a function of theta, so we input hte theta grid.</span></span>
<span id="cb139-5"><a href="cross.html#cb139-5" aria-hidden="true" tabindex="-1"></a> pred.prob<span class="ot">&lt;-</span><span class="fu">sapply</span>(ytilde,<span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">dpois</span>(x,<span class="at">lambda =</span> theta_post)<span class="sc">*</span>post_pois<span class="sc">/</span><span class="fu">sum</span>(post_pois)))  </span>
<span id="cb139-6"><a href="cross.html#cb139-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-7"><a href="cross.html#cb139-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(ytilde,pred.prob, <span class="at">main=</span><span class="st">&#39;predictive distribution for future 1986&#39;</span>)</span>
<span id="cb139-8"><a href="cross.html#cb139-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">abline</span>(<span class="at">v=</span><span class="fu">quantile</span>(ytilde,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-26-2.png" width="672" /></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="cross.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lines(theta,post_pois)</span></span>
<span id="cb140-2"><a href="cross.html#cb140-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">quantile</span>(ytilde,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##    2.5%   97.5% 
## 637.000 746.025</code></pre>
<ul>
<li><ol start="4" style="list-style-type: lower-alpha">
<li>Using the rate the posterior rate mean is 0.12 estimated from sampling the posterior distribution. For 8 x 10<span class="math inline">\(^11\)</span> miles flown the deaths are approximately 970 (902, 1039) this is higher than the 1986 observed value.</li>
</ol></li>
</ul>
<p>Note we used Jeffreys’ prior here, but an empirical prior is okay</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="cross.html#cb142-1" aria-hidden="true" tabindex="-1"></a>  theta<span class="ot">=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>,<span class="at">to=</span><span class="fl">0.1</span>,<span class="at">by=</span>.<span class="dv">001</span>)</span>
<span id="cb142-2"><a href="cross.html#cb142-2" aria-hidden="true" tabindex="-1"></a> miles100<span class="ot">&lt;-</span>death<span class="sc">/</span>rate <span class="do">## 100 million miles</span></span>
<span id="cb142-3"><a href="cross.html#cb142-3" aria-hidden="true" tabindex="-1"></a> miles<span class="ot">&lt;-</span>miles100<span class="sc">*</span><span class="dv">100000000</span></span>
<span id="cb142-4"><a href="cross.html#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="cross.html#cb142-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb142-6"><a href="cross.html#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="cross.html#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="cross.html#cb142-8" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb142-9"><a href="cross.html#cb142-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## we must use Jeffreys&#39; prior</span></span>
<span id="cb142-10"><a href="cross.html#cb142-10" aria-hidden="true" tabindex="-1"></a>    Jalpha<span class="ot">=</span><span class="fl">0.01</span></span>
<span id="cb142-11"><a href="cross.html#cb142-11" aria-hidden="true" tabindex="-1"></a>  Jbeta<span class="ot">&lt;-</span><span class="fl">0.01</span></span>
<span id="cb142-12"><a href="cross.html#cb142-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(theta,<span class="fu">dgamma</span>(theta,Jalpha,<span class="at">rate=</span>Jbeta),<span class="at">col=</span><span class="st">&#39;blue&#39;</span>,<span class="at">xlab=</span><span class="st">&#39;passanger death rate per miles&#39;</span>,<span class="at">main=</span><span class="st">&quot;Jeffreys&#39; prior&quot;</span>)</span>
<span id="cb142-13"><a href="cross.html#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(theta,<span class="fu">dgamma</span>(theta,Jalpha<span class="sc">+</span><span class="fu">sum</span>(death),<span class="at">rate=</span>Jbeta<span class="sc">+</span><span class="fu">sum</span>(miles)),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="cross.html#cb143-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## credible interval of the posterior</span></span>
<span id="cb143-2"><a href="cross.html#cb143-2" aria-hidden="true" tabindex="-1"></a> pois_credible<span class="ot">&lt;-</span><span class="fu">qgamma</span>(<span class="fu">c</span>(.<span class="dv">025</span>,<span class="fl">0.975</span>),Jalpha<span class="sc">+</span><span class="fu">sum</span>(death),<span class="at">rate=</span>Jbeta<span class="sc">+</span><span class="fu">sum</span>(miles))</span>
<span id="cb143-3"><a href="cross.html#cb143-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="st">&quot;Jeffreys&#39; prior posterior gamma interval n=10: &quot;</span>)</span></code></pre></div>
<pre><code>## Jeffreys&#39; prior posterior gamma interval n=10:</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="cross.html#cb145-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(pois_credible) <span class="do">## </span></span></code></pre></div>
<pre><code>## [1] 1.182135e-09 1.239179e-09</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="cross.html#cb147-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(theta,<span class="fu">dgamma</span>(theta,alpha,<span class="at">rate=</span>beta),<span class="at">lty=</span><span class="dv">2</span>, <span class="at">main=</span><span class="st">&#39;empirical estimated prior&#39;</span>)</span>
<span id="cb147-2"><a href="cross.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(theta,<span class="fu">dgamma</span>(theta,alpha<span class="sc">+</span><span class="fu">sum</span>(death),<span class="at">rate=</span>beta<span class="sc">+</span><span class="fu">sum</span>(miles)),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-27-2.png" width="672" /></p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="cross.html#cb148-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## credible interval of the posterior</span></span>
<span id="cb148-2"><a href="cross.html#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="cross.html#cb148-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-4"><a href="cross.html#cb148-4" aria-hidden="true" tabindex="-1"></a> theta_post<span class="ot">&lt;-</span><span class="fu">rgamma</span>(<span class="dv">1000</span>,Jalpha<span class="sc">+</span><span class="fu">sum</span>(death),<span class="at">rate=</span>Jbeta<span class="sc">+</span><span class="fu">sum</span>(miles))</span>
<span id="cb148-5"><a href="cross.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  y1986<span class="ot">&lt;-</span><span class="fu">rpois</span>(<span class="dv">1000</span>,<span class="fl">8e+11</span><span class="sc">*</span>theta_post) <span class="do">## use in the likelihood</span></span>
<span id="cb148-6"><a href="cross.html#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot; 8,000 per 100 million miles flown has passanger death : Gamma posterior &amp; Jeffreys&#39; prior&quot;</span>)</span></code></pre></div>
<pre><code>##  8,000 per 100 million miles flown has passanger death : Gamma posterior &amp; Jeffreys&#39; prior</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="cross.html#cb150-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">sort</span>(y1986)[<span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">976</span>)])</span></code></pre></div>
<pre><code>## [1]  906 1037</code></pre>
</div>
<div id="question-21" class="section level3 hasAnchor" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Question 21<a href="cross.html#question-21" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>estimate percentage of adult population in each state (excluding alaska and hawaii) who label themselves as very liberal. plot estimate vs. obama’s vote share in 2008.</p>
<p>For each state we measure <span class="math inline">\(y_j\sim Pois(n_j\theta_j)\)</span> from section 2.7 where y is the number of adult population who identify themselves as <em>very liberal</em> in ideology for a given state.</p>
<p>we do not have population of each state, but we do have the number of respondents of each state, and denote <span class="math inline">\(n_j\)</span> as the integer representing the total respondents.</p>
<p>Alternatively, we do have census density category for each state (1-5) which can account for the populaiton density.</p>
<ul>
<li><ol style="list-style-type: lower-alpha">
<li>graph the proportion of liberal in each state vs obama vote share. here the proportion of liberal votes was weighted by the total respondents</li>
</ol></li>
</ul>
<p>we see that the highest proportion of very liberal polls is associated with the states with the highest obama percentage of votes in CA, NY, WA, and IL. Conversely we see that WY UT, OK are very red states with low polls in very liberal voters, with the lowest support for obama.</p>
<p>For those that identify as <em>liberal</em> we see a much linear trend.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="cross.html#cb152-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(foreign)</span>
<span id="cb152-2"><a href="cross.html#cb152-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## Warning: package &#39;dplyr&#39; was built under R version 4.2.1</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="cross.html#cb157-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(magrittr)</span>
<span id="cb157-2"><a href="cross.html#cb157-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(ggplot2)</span>
<span id="cb157-3"><a href="cross.html#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co">#polls&lt;-read.dta(&quot;C:/Users/UOSC/Documents/Keck-graduate-school/PM590-Bayesian/bookdown-files/pew_research_center_june_elect_wknd_data.dta&quot;)</span></span>
<span id="cb157-4"><a href="cross.html#cb157-4" aria-hidden="true" tabindex="-1"></a>polls<span class="ot">&lt;-</span><span class="fu">read.dta</span>(<span class="st">&quot;C:/Users/antho/Documents/Keck-graduate-school/PM590-Bayesian/bookdown-files/pew_research_center_june_elect_wknd_data.dta&quot;</span>)</span>
<span id="cb157-5"><a href="cross.html#cb157-5" aria-hidden="true" tabindex="-1"></a> <span class="co">#proportion of very liberal</span></span>
<span id="cb157-6"><a href="cross.html#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(polls<span class="sc">$</span>ideo)</span></code></pre></div>
<pre><code>## 
## missing/not asked very conservative      conservative          moderate 
##                 0              2417              9795             11197 
##           liberal      very liberal        dk/refused 
##              4535              1470              1380</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="cross.html#cb159-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## adult pop</span></span>
<span id="cb159-2"><a href="cross.html#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(polls<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>## 
##  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37 
## 628 431 363 341 316 374 355 343 406 337 391 398 446 366 375 378 334 398 417 482 
##  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57 
## 509 441 617 464 542 470 529 582 571 615 639 593 891 598 727 618 639 731 600 541 
##  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77 
## 662 561 799 584 590 419 489 596 422 426 373 368 494 294 358 266 256 323 260 269 
##  78  79  80  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97 
## 233 220 337 195 179 143 126 132 106  97  81  73  62  25  21  13   9   7   2  18 
##  99 
## 517</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="cross.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(polls<span class="sc">$</span>age2)</span></code></pre></div>
<pre><code>## 
##       18-29       30-49       50-64         65+ dk\\refused 
##        4683        9768        9449        6784         517</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="cross.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="do">## each state</span></span>
<span id="cb163-2"><a href="cross.html#cb163-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">table</span>(polls<span class="sc">$</span>state)</span></code></pre></div>
<pre><code>## 
##        alabama         alaska        arizona       arkansas     california 
##            624              0            542            307           2854 
##       colorado    connecticut       delaware  washington dc        florida 
##            468            395            119             62           1747 
##        georgia         hawaii          idaho       illinois        indiana 
##           1023              1            140           1130            829 
##           iowa         kansas       kentucky      louisiana          maine 
##            441            329            523            603            154 
##       maryland  massachusetts       michigan      minnesota    mississippi 
##            593            685           1000            711            264 
##       missouri        montana       nebraska         nevada  new hampshire 
##            780             91            215            202            160 
##     new jersey     new mexico       new york north carolina   north dakota 
##            870            219           1701           1055            120 
##           ohio       oklahoma         oregon   pennsylvania   rhode island 
##           1404            431            468           1591            131 
## south carolina   south dakota      tennessee          texas           utah 
##            458             93            745           1919            284 
##        vermont       virginia     washington  west virginia      wisconsin 
##            115            896            668            270            742 
##        wyoming 
##             29</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="cross.html#cb165-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># drop AL and HA</span></span>
<span id="cb165-2"><a href="cross.html#cb165-2" aria-hidden="true" tabindex="-1"></a>polls<span class="ot">&lt;-</span>polls[<span class="fu">which</span>(polls<span class="sc">$</span>state<span class="sc">!=</span><span class="st">&quot;alaska&quot;</span> <span class="sc">&amp;</span> polls<span class="sc">$</span>state<span class="sc">!=</span><span class="st">&quot;hawaii&quot;</span>),] </span>
<span id="cb165-3"><a href="cross.html#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="co"># average the points that are missing.</span></span>
<span id="cb165-4"><a href="cross.html#cb165-4" aria-hidden="true" tabindex="-1"></a>polls<span class="sc">$</span>density[<span class="fu">which</span>(<span class="fu">is.na</span>(polls<span class="sc">$</span>density))]<span class="ot">&lt;-</span><span class="fu">mean</span>(polls<span class="sc">$</span>density[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(polls<span class="sc">$</span>density))])</span>
<span id="cb165-5"><a href="cross.html#cb165-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-6"><a href="cross.html#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="co">#ele&lt;-read.csv(&quot;C:/Users/UOSC/Documents/Keck-graduate-school/PM590-Bayesian/bookdown-files/2008ElectionResult.csv&quot;)</span></span>
<span id="cb165-7"><a href="cross.html#cb165-7" aria-hidden="true" tabindex="-1"></a>ele<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;C:/Users/antho/Documents/Keck-graduate-school/PM590-Bayesian/bookdown-files/2008ElectionResult.csv&quot;</span>)</span>
<span id="cb165-8"><a href="cross.html#cb165-8" aria-hidden="true" tabindex="-1"></a>ele<span class="ot">&lt;-</span>ele[<span class="fu">which</span>(ele<span class="sc">$</span>state<span class="sc">!=</span><span class="st">&quot;Alaska&quot;</span><span class="sc">&amp;</span> ele<span class="sc">$</span>state<span class="sc">!=</span><span class="st">&quot;Hawaii&quot;</span>),]</span>
<span id="cb165-9"><a href="cross.html#cb165-9" aria-hidden="true" tabindex="-1"></a>ele<span class="sc">$</span>state<span class="ot">&lt;-</span><span class="fu">tolower</span>(ele<span class="sc">$</span>state)</span>
<span id="cb165-10"><a href="cross.html#cb165-10" aria-hidden="true" tabindex="-1"></a><span class="do">## graph poprotion liberal in each state vs obama vote share scatter.</span></span>
<span id="cb165-11"><a href="cross.html#cb165-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-12"><a href="cross.html#cb165-12" aria-hidden="true" tabindex="-1"></a>yj<span class="ot">&lt;-</span><span class="fu">as.data.frame.matrix</span>(<span class="fu">table</span>(polls<span class="sc">$</span>state,polls<span class="sc">$</span>ideo))</span>
<span id="cb165-13"><a href="cross.html#cb165-13" aria-hidden="true" tabindex="-1"></a>nj<span class="ot">&lt;-</span><span class="fu">as.data.frame.matrix</span>(<span class="fu">table</span>(polls<span class="sc">$</span>state,polls<span class="sc">$</span>density))</span>
<span id="cb165-14"><a href="cross.html#cb165-14" aria-hidden="true" tabindex="-1"></a><span class="do">## ideology</span></span>
<span id="cb165-15"><a href="cross.html#cb165-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(yj)</span></code></pre></div>
<pre><code>##            missing/not asked very conservative conservative moderate liberal
## alabama                    0                82          254      165      48
## alaska                     0                 0            0        0       0
## arizona                    0                33          152      201      95
## arkansas                   0                30          115      101      29
## california                 0               178          728     1054     549
## colorado                   0                31          134      165      96
##            very liberal dk/refused
## alabama              30         38
## alaska                0          0
## arizona              28         24
## arkansas              7         22
## california          179        121
## colorado             27         12</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="cross.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="do">## density</span></span>
<span id="cb167-2"><a href="cross.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nj)</span></code></pre></div>
<pre><code>##              1   2 2.8302567571921   3   4   5
## alabama    247 196               9 170   2   0
## alaska       0   0               0   0   0   0
## arizona    247   1               0 294   0   0
## arkansas   148 120               4  35   0   0
## california 455 496              19 438 566 880
## colorado   123 157               7 101   1  79</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="cross.html#cb169-1" aria-hidden="true" tabindex="-1"></a> tally<span class="ot">&lt;-</span>polls<span class="sc">%&gt;%</span><span class="fu">group_by</span>(state,ideo)<span class="sc">%&gt;%</span><span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;state&#39;. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="cross.html#cb171-1" aria-hidden="true" tabindex="-1"></a> statetotal<span class="ot">&lt;-</span>tally<span class="sc">%&gt;%</span><span class="fu">group_by</span>(state)<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="at">statetotal=</span><span class="fu">sum</span>(n))</span>
<span id="cb171-2"><a href="cross.html#cb171-2" aria-hidden="true" tabindex="-1"></a> tally<span class="ot">&lt;-</span><span class="fu">left_join</span>(tally,statetotal,<span class="at">by=</span><span class="st">&#39;state&#39;</span>)</span>
<span id="cb171-3"><a href="cross.html#cb171-3" aria-hidden="true" tabindex="-1"></a> <span class="do">## average the density of the polling regions by state taking the density of each zip code (category 1-5)</span></span>
<span id="cb171-4"><a href="cross.html#cb171-4" aria-hidden="true" tabindex="-1"></a> densit<span class="ot">&lt;-</span>polls<span class="sc">%&gt;%</span><span class="fu">group_by</span>(state)<span class="sc">%&gt;%</span><span class="fu">summarize</span>(<span class="at">density=</span><span class="fu">mean</span>(density))</span>
<span id="cb171-5"><a href="cross.html#cb171-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb171-6"><a href="cross.html#cb171-6" aria-hidden="true" tabindex="-1"></a> <span class="co"># highest states with highest density</span></span>
<span id="cb171-7"><a href="cross.html#cb171-7" aria-hidden="true" tabindex="-1"></a> densit[<span class="fu">order</span>(densit<span class="sc">$</span>density,<span class="at">decreasing =</span> T),]</span></code></pre></div>
<pre><code>## # A tibble: 49 × 2
##    state         density
##    &lt;fct&gt;           &lt;dbl&gt;
##  1 washington dc    4.95
##  2 new jersey       3.99
##  3 rhode island     3.93
##  4 maryland         3.62
##  5 new york         3.60
##  6 massachusetts    3.58
##  7 connecticut      3.55
##  8 illinois         3.42
##  9 california       3.32
## 10 ohio             3.32
## # … with 39 more rows</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="cross.html#cb173-1" aria-hidden="true" tabindex="-1"></a> tally<span class="ot">&lt;-</span><span class="fu">left_join</span>(tally,densit,<span class="at">by=</span><span class="st">&#39;state&#39;</span>)</span>
<span id="cb173-2"><a href="cross.html#cb173-2" aria-hidden="true" tabindex="-1"></a>  tally<span class="sc">$</span>popdensity<span class="ot">&lt;-</span>tally<span class="sc">$</span>n<span class="sc">/</span>tally<span class="sc">$</span>density</span>
<span id="cb173-3"><a href="cross.html#cb173-3" aria-hidden="true" tabindex="-1"></a>    tally<span class="sc">$</span>stateperc<span class="ot">&lt;-</span><span class="dv">100</span><span class="sc">*</span>tally<span class="sc">$</span>n<span class="sc">/</span>tally<span class="sc">$</span>statetotal</span>
<span id="cb173-4"><a href="cross.html#cb173-4" aria-hidden="true" tabindex="-1"></a>    tally<span class="sc">$</span>stateperc_density<span class="ot">&lt;-</span><span class="dv">100</span><span class="sc">*</span>tally<span class="sc">$</span>n<span class="sc">/</span>(tally<span class="sc">$</span>statetotal<span class="sc">*</span>tally<span class="sc">$</span>density)</span>
<span id="cb173-5"><a href="cross.html#cb173-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-6"><a href="cross.html#cb173-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb173-7"><a href="cross.html#cb173-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-8"><a href="cross.html#cb173-8" aria-hidden="true" tabindex="-1"></a>tt<span class="ot">&lt;-</span><span class="fu">left_join</span>(ele,tally,<span class="at">by=</span><span class="st">&quot;state&quot;</span>)</span>
<span id="cb173-9"><a href="cross.html#cb173-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-10"><a href="cross.html#cb173-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tt[<span class="fu">which</span>(tt<span class="sc">$</span>ideo<span class="sc">==</span><span class="st">&#39;very liberal&#39;</span>),],<span class="fu">aes</span>(<span class="at">x=</span>stateperc,<span class="at">y=</span>vote_Obama_pct,<span class="at">label=</span>state))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span><span class="fu">geom_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="dv">0</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;very liberal proportion vs. obama vote (%)&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="cross.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tt[<span class="fu">which</span>(tt<span class="sc">$</span>ideo<span class="sc">==</span><span class="st">&#39;liberal&#39;</span>),],<span class="fu">aes</span>(<span class="at">x=</span>stateperc,<span class="at">y=</span>vote_Obama_pct,<span class="at">label=</span>state))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span><span class="fu">geom_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="dv">0</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;liberal proportion vs. obama vote (%)&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-28-2.png" width="672" /></p>
<ul>
<li><ol start="2" style="list-style-type: lower-alpha">
<li>Graph the posterior Bayes mean vs. the Obama vote share.
In order to construct the prior we use equations (2.17, 2.18) where we match the moments from the prior predictive distribution to the observed data for each state. <span class="math inline">\(p(\tilde{y})\sim Neg-Bin(\alpha, \beta)\)</span> follows a negative binomial distribution.</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="cross.html#cb175-1" aria-hidden="true" tabindex="-1"></a> <span class="do">## we need to understand the underlying rates in a prior for gamma given multiple states.</span></span>
<span id="cb175-2"><a href="cross.html#cb175-2" aria-hidden="true" tabindex="-1"></a> vl<span class="ot">&lt;-</span><span class="fu">subset</span>(tally,tally<span class="sc">$</span>ideo<span class="sc">==</span><span class="st">&#39;very liberal&#39;</span>)</span>
<span id="cb175-3"><a href="cross.html#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(vl<span class="sc">$</span>stateperc, <span class="at">xlab=</span><span class="st">&quot;very lib. (%)&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;frequency&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="cross.html#cb176-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for each state we must identify the estimate</span></span>
<span id="cb176-2"><a href="cross.html#cb176-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb176-3"><a href="cross.html#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## empircal bayesian prior for percentage of respondents</span></span>
<span id="cb176-4"><a href="cross.html#cb176-4" aria-hidden="true" tabindex="-1"></a> emp.mean<span class="ot">&lt;-</span><span class="fu">mean</span>(vl<span class="sc">$</span>stateperc)</span>
<span id="cb176-5"><a href="cross.html#cb176-5" aria-hidden="true" tabindex="-1"></a> emp.var<span class="ot">&lt;-</span><span class="fu">var</span>(vl<span class="sc">$</span>stateperc)</span>
<span id="cb176-6"><a href="cross.html#cb176-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-7"><a href="cross.html#cb176-7" aria-hidden="true" tabindex="-1"></a>  beta<span class="ot">=</span>beta<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">/</span>((<span class="fu">var</span>(vl<span class="sc">$</span>stateperc)<span class="sc">-</span>(<span class="fu">mean</span>(<span class="dv">1</span><span class="sc">/</span>vl<span class="sc">$</span>density))<span class="sc">*</span>emp.mean)<span class="sc">/</span>(emp.mean))</span>
<span id="cb176-8"><a href="cross.html#cb176-8" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">=</span> beta<span class="sc">*</span>emp.mean</span>
<span id="cb176-9"><a href="cross.html#cb176-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb176-10"><a href="cross.html#cb176-10" aria-hidden="true" tabindex="-1"></a>alpha_unif<span class="ot">=</span> <span class="fl">0.01</span></span>
<span id="cb176-11"><a href="cross.html#cb176-11" aria-hidden="true" tabindex="-1"></a>beta_unif <span class="ot">=</span> <span class="fl">0.01</span></span>
<span id="cb176-12"><a href="cross.html#cb176-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-13"><a href="cross.html#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="fu">qgamma</span>(<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>),alpha,beta)</span></code></pre></div>
<pre><code>## [1] 2.422521 7.788166</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="cross.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(tally<span class="sc">$</span>prop,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))  </span></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: `prop`.</code></pre>
<pre><code>##  2.5% 97.5% 
##    NA    NA</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="cross.html#cb181-1" aria-hidden="true" tabindex="-1"></a>  theta<span class="ot">=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>,<span class="at">to=</span><span class="fl">0.1</span>,<span class="at">by=</span>.<span class="dv">001</span>)</span>
<span id="cb181-2"><a href="cross.html#cb181-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(theta,<span class="fu">dgamma</span>(theta,alpha,<span class="at">rate=</span>beta),<span class="at">lty=</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="st">&#39;very liberal voters by state&#39;</span>)</span>
<span id="cb181-3"><a href="cross.html#cb181-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(theta,<span class="fu">dgamma</span>(theta,alpha_unif,<span class="at">rate=</span>beta_unif),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-29-2.png" width="672" /></p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="cross.html#cb182-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span>tt[<span class="fu">which</span>(tt<span class="sc">$</span>ideo<span class="sc">==</span><span class="st">&#39;very liberal&#39;</span>),]</span>
<span id="cb182-2"><a href="cross.html#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="cross.html#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="cross.html#cb182-4" aria-hidden="true" tabindex="-1"></a>post<span class="ot">&lt;-</span><span class="cf">function</span>(theta,yj,nj){</span>
<span id="cb182-5"><a href="cross.html#cb182-5" aria-hidden="true" tabindex="-1"></a> dd<span class="ot">&lt;-</span><span class="fu">dgamma</span>(theta,alpha<span class="sc">+</span>yj,<span class="at">rate=</span>beta<span class="sc">+</span>nj)</span>
<span id="cb182-6"><a href="cross.html#cb182-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(dd)</span>
<span id="cb182-7"><a href="cross.html#cb182-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb182-8"><a href="cross.html#cb182-8" aria-hidden="true" tabindex="-1"></a>postMean<span class="ot">&lt;-</span><span class="cf">function</span>(alpha,yj,beta,nj){</span>
<span id="cb182-9"><a href="cross.html#cb182-9" aria-hidden="true" tabindex="-1"></a>  (alpha<span class="sc">+</span>yj)<span class="sc">/</span>(beta<span class="sc">+</span>nj)</span>
<span id="cb182-10"><a href="cross.html#cb182-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb182-11"><a href="cross.html#cb182-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb182-12"><a href="cross.html#cb182-12" aria-hidden="true" tabindex="-1"></a>post_thetaj<span class="ot">&lt;-</span> <span class="fu">postMean</span>(alpha_unif,dat<span class="sc">$</span>n,beta_unif,dat<span class="sc">$</span>density)</span>
<span id="cb182-13"><a href="cross.html#cb182-13" aria-hidden="true" tabindex="-1"></a>pp<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">state=</span>dat<span class="sc">$</span>state,<span class="at">post=</span><span class="fu">postMean</span>(alpha_unif,dat<span class="sc">$</span>n,beta_unif,dat<span class="sc">$</span>density))</span>
<span id="cb182-14"><a href="cross.html#cb182-14" aria-hidden="true" tabindex="-1"></a>tt2<span class="ot">&lt;-</span><span class="fu">left_join</span>(ele,pp,<span class="at">by=</span><span class="st">&quot;state&quot;</span>)</span>
<span id="cb182-15"><a href="cross.html#cb182-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tt2,<span class="fu">aes</span>(<span class="at">x=</span>post,<span class="at">y=</span>vote_Obama_pct,<span class="at">label=</span>state))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span><span class="fu">geom_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_text).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-29-3.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fundamentals-of-bayesian-inference.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/02-single-parameter-models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
